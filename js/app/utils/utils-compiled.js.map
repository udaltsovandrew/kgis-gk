{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils-compiled.js","sourcesContent":["\"use strict\";\n\ndefine([\n    //'../../../../Application/'+_currentServer+'/config/config-compiled.js',\n    './js/app/dataAccess/model-compiled.js',\n    './js/app/domain/carto-compiled.js',\n    './js/app/domain/generators-compiled.js',\n    './js/app/forms/forms-compiled.js',\n    'dojo/store/Memory',\n    'dojo/store/Observable',\n    'dijit/tree/ObjectStoreModel',\n    'dijit/Tree',\n    'esri/layers/VectorTileLayer',\n    'esri/layers/FeatureLayer',\n    'esri/Color',\n    'esri/symbols/SimpleMarkerSymbol',\n    'esri/symbols/SimpleLineSymbol',\n    'esri/dijit/editing/Editor',\n    'esri/dijit/editing/TemplatePicker',\n    'esri/dijit/LayerList',\n    'esri/undoManager',\n    'esri/dijit/Search',\n    'esri/dijit/Scalebar',\n    'esri/dijit/LocateButton',\n    'dojo/_base/array',\n    'dojo/request',\n    'dojo/domReady!'\n  ],\n  \n  function (//coreConfig,\n    model,\n    carto,\n    generators,\n    forms,\n    Memory,\n    Observable,\n    ObjectStoreModel,\n    Tree,\n    VectorTileLayer,\n    FeatureLayer,\n    Color,\n    SimpleMarkerSymbol,\n    SimpleLineSymbol,\n    Editor,\n    TemplatePicker,\n    LayerList,\n    UndoManager,\n    Search,\n    Scalebar,\n    LocateButton,\n    arrayUtils,\n    request) {\n    \n    var wainInfoWindowInterval = null;\n    var context = new model({url: \"\", className: \"\", map: map});\n    \n    function loadControls() {\n      initExitEvent();\n      initSearchControl();\n      initLocateButton();\n      initBaseMapList();\n      initScaleBar();\n      initEditorWindow();\n      initLayersWindow();\n      initLayerList();\n      initTreeIdentifiedObject();\n      initPanelHandlers();\n      initToolsControls();\n    }\n    \n    function initExitEvent() {\n      window.onbeforeunload = closingCode;\n      function closingCode() {\n        saveMapSettings();\n        session.attributes[\"sessionTimeEnd\"] = Date.now();\n        session.attributes[\"sessionStatus\"] = \"закрытая\";\n        db.Session.set(session);\n      }\n    }\n    \n    function saveMapSettings() {\n      //localStorage.setItem(\"extent\", JSON.stringify(map.extent));\n      //localStorage.setItem(\"zoom\", JSON.stringify(map.getZoom()));\n    }\n    \n    function initToolsControls() {\n      bindClick(\"window-tools\", function () {\n        forms.toWindow(\"tools-container\", \"Инструменты\");\n        forms.showWindow(\"tools-container\");\n      });\n      bindClick(\"gpxToStructure\", function () {\n        logic.pointToFeature(\"Structure\", carto.getGpxPoint()).then(function () {\n          _getEditorLayer(\"Structure\").refresh();\n        });\n      });\n      bindClick(\"gpxToSubstation\", function () {\n        logic.pointToFeature(\"Substation\", carto.getGpxPoint()).then(function () {\n          _getEditorLayer(\"Substation\").refresh();\n        });\n      });\n      bindClick(\"gpxToSwitch\", function () {\n        logic.pointToFeature(\"Switch\", carto.getGpxPoint()).then(function () {\n          _getEditorLayer(\"Switch\").refresh();\n        });\n      });\n    }\n    \n    function initLocateButton() {\n      var locateButton = new LocateButton({\n        map:                map,\n        useTracking:        true,\n        geolocationOptions: {\n          maximumAge:         3,\n          timeout:            1000,\n          enableHighAccuracy: true\n        }\n      }, \"locateButton\");\n      locateButton.startup();\n    }\n    \n    function createFeatureLayer(params) {\n      return new FeatureLayer(params.url, {\n        id:         params.id,\n        outFields:  ['*'],\n        mode:       FeatureLayer.MODE_SNAPSHOT,\n        tileHeight: 1600,\n        tileWidth:  1600,\n        showLabels: true\n      });\n    }\n    \n    function loadVectorLayers() {\n      if (coreConfig.layers) {\n        for (var i = 0; i < coreConfig.layers.length; i++) {\n          var layer = createFeatureLayer(coreConfig.layers[i]);\n          store.layers.push(layer);\n          map.addLayer(layer);\n        }\n      }\n    }\n    \n    function loadEditorLayers(currentSession) {\n      var mapEditors = [];\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        var layer = createFeatureLayer(coreConfig.editors[i]);\n        layer.setScaleRange(coreConfig.editors[i].minScale, coreConfig.editors[i].maxScale);\n        if (isCustomRenderer(coreConfig.editors[i].id) == true) {\n          layer.setRenderer(getLayerDefaultRenderer(coreConfig.editors[i].id));\n        }\n        layer.on(\"edits-complete\", coreConfig.editors[i].editorHandler);\n        layer.on(\"click\", coreConfig.editors[i].clickHandler);\n        layer.on(\"mouse-over\", waitForInfo);\n        store.editors.push(layer);\n        \n        var usage = \"system\";\n        if (coreConfig.editors[i].load == true) {\n          var layerName = coreConfig.editors[i].id;\n          var key = currentSession.attributes.userGroup + \".\" + currentSession.attributes.userRole;\n          var roleEditors = coreConfig.roles[key][\"editors\"];\n          if (roleEditors.some(function (item) {\n              return item == layerName\n            })) {\n            mapEditors.push(layer);\n          }\n          usage = \"common\";\n        }\n        \n        db[coreConfig.editors[i].id] = new model({\n          url:        _getConf(coreConfig.editors[i].id).url,\n          classAlias: _getConf(coreConfig.editors[i].id).alias,\n          className:  coreConfig.editors[i].id,\n          usage:      usage,\n          map:        map\n        });\n      }\n      \n      map.on(\"zoom-end\", updateRenderers);\n      map.addLayers(mapEditors);\n    }\n    \n    function waitForInfo() {\n      if (wainInfoWindowInterval == null) {\n        wainInfoWindowInterval = setTimeout(function () {\n          wainInfoWindowInterval = null;\n        }, 10);\n      }\n    }\n    \n    function updateRenderers() {\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        var layer = _getEditorLayer(coreConfig.editors[i].id);\n        layer.setScaleRange(coreConfig.editors[i].minScale, coreConfig.editors[i].maxScale);\n        if (isCustomRenderer(coreConfig.editors[i].id) == true) {\n          layer.setRenderer(getLayerDefaultRenderer(coreConfig.editors[i].id));\n        }\n      }\n    }\n    \n    function isCustomRenderer(id) {\n      return coreConfig.renderers[id] !== undefined;\n    }\n    \n    function getLayerDefaultRenderer(id) {\n      return carto.getUniqueRenderer(coreConfig.renderers[id][\"default\"]);\n    }\n    \n    function loadDB() {\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        db[coreConfig.editors[i].id] = new model({\n          url:       _getConf(coreConfig.editors[i].id).url,\n          className: coreConfig.editors[i].id\n        });\n      }\n    }\n    \n    function initPanelHandlers() {\n      bindClick(\"window-layers\", function () {\n        forms.showWindow(\"layers-container\")\n      });\n      \n      bindClick(\"window-editor\", function () {\n        forms.showWindow(\"editor-container\")\n      });\n      \n      bindClick(\"window-table\", function () {\n        forms.showWindow(\"list-container\")\n      });\n      \n      bindClick(\"window-gpx\", function () {\n        forms.showWindow(\"gpx-container\")\n      });\n    }\n    \n    function initLoginWindow() {\n      //if (window.location.hostname != \"vm.igit.spb.ru\") return;\n      //noinspection JSUnresolvedFunction\n      $(\"#login-container\").kendoWindow({\n        actions:   [\"Pin\"],\n        modal:     true,\n        draggable: false\n      });\n      var panel = $(\"#login-container\").data(\"kendoWindow\");\n      panel.pin();\n      panel.title(\"Авторизация\");\n      panel.open();\n      panel.center();\n      panel.maximize();\n      \n      return new Promise(function (resolve, reject) {\n        bindClick(\"login\", function () {\n          return verifyCredentials(panel).then(function (data) {\n            resolve(data);\n          });\n        });\n        \n      });\n      \n    }\n    \n    function verifyCredentials(panel) {\n      var username = $(\"#username\").val();\n      var password = $(\"#password\").val();\n      //forms.hideNode(\"update-technical-connection\");\n      //forms.showWindow(\"editor-container\");\n      panel.close();\n      db.Session = new model({url: _getConf(\"Session\").url});\n      db.Account = new model({url: _getConf(\"Account\").url});\n      var _session = null;\n      return db.Session\n        .get({where: \"sessionStatus = 'активная'\"})\n        .then(function (data) {\n          var activeSessions = context.all(data);\n          if (activeSessions.length > 1000 * coreConfig.maxSessionNumber) {\n            forms.showNotify(\"Все соединения с сервером исчерпаны (\" + activeSessions.length + \" из \" + coreConfig.maxSessionNumber + \"). \" +\n              \"В случае снижения производительности, попробуйте перезагрузить редактор через несколько минут или попросите коллег завершить текущие сеансы работы.\", \"info\");\n          }\n          else {\n            return db.Account.get({where: \"1=1\"})\n              .then(function (data) {\n                var accounts = data.features;\n                for (var i = 0; i < accounts.length; i++) {\n                  if ((accounts[i].attributes.userName == username) && (accounts[i].attributes.password == password)) {\n                    userAccount = accounts[i];\n                    break;\n                  }\n                }\n                if (userAccount != null) {\n                  _session = generators.Session.default;\n                  _session.attributes[\"userName\"] = userAccount.attributes.userName;\n                  _session.attributes[\"sessionStatus\"] = \"активная\";\n                  _session.attributes[\"sessionTimeStart\"] = Date.now();\n                  _session.attributes[\"userRole\"] = userAccount.attributes.userRole;\n                  _session.attributes[\"userGroup\"] = userAccount.attributes.userGroup;\n                  _session.geometry = carto.getGpxPoint();\n                  return db.Session.add(_session);\n                }\n              })\n              .then(function (data) {\n                var id = data[0][0].objectId;\n                return db.Session.getById(id);\n              })\n              .then(function (data) {\n                switch (userAccount.attributes.userRole) {\n                  case 'администратор':\n                    forms.showNode(\"accounts-manage\");\n                    forms.showNode(\"session-manage\");\n                    break;\n                }\n                switch (userAccount.attributes.userGroup) {\n                  case \"ИКТП\":\n                    forms.showNode(\"update-technical-connection\");\n                    break;\n                }\n                panel.close();\n                forms.hideNode(\"update-technical-connection\");\n                //forms.showWindow(\"editor-container\");\n                session = context.first(data);\n                //updateSessionStatus();\n                return new Promise(function (resolve, reject) {\n                  resolve(_session);\n                });\n              })\n          }\n        })\n    }\n    \n    function initEditorWindow() {\n      //noinspection JSUnresolvedFunction\n      $(\"#editor-container\").kendoWindow({\n        actions:  [\"Minimize\", \"Maximize\", \"Close\"],\n        position: {\n          top:        65,\n          left:       '78%',\n          scrollable: true\n        },\n        width:    '21%'\n      });\n      var panel = $(\"#editor-container\").data(\"kendoWindow\");\n      panel.pin();\n      panel.title(\"Панель объектов\");\n      panel.close();\n    }\n    \n    function initLayersWindow() {\n      //noinspection JSUnresolvedFunction\n      $(\"#layers-container\").kendoWindow({\n        actions:  [\"Close\"]\n      });\n      var panel = $(\"#layers-container\").data(\"kendoWindow\");\n      panel.pin();\n      panel.title(\"Слои\");\n      panel.maximize();\n      panel.close();\n    }\n    \n    function initTableFeatureLayer() {\n      //noinspection JSUnresolvedFunction\n      $(\"#table-container\").kendoWindow({\n        actions:  [\"Minimize\", \"Maximize\", \"Close\"],\n        position: {\n          top:  '65px',\n          left: '10px'\n        },\n        width:    '40%'\n      });\n      var panel = $(\"#table-container\").data(\"kendoWindow\");\n      panel.pin();\n      panel.title(\"Реестр объектов\");\n      panel.close();\n      \n      logic.loadPowerLineList();\n      logic.loadSubstationList();\n      \n      /*\n       var tabsElementName = \"featuresTabs\";\n       var tabsContainer = \"featuresTabsContainer\";\n       \n       \n       var tabs = [\n       {\n       item: db.SACEvent, name: \"Мероприятия\"\n       },\n       ]\n       \n       for (var i=0; i<tabs.length; i++){\n       forms.generateTab(tabsElementName, tabs[i].item, tabs[i].name);\n       forms.generateTabContainer(tabsContainer, tabs[i].item);\n       logic.initFeatureTable(tabs[i].item);\n       }\n       */\n      \n    }\n    \n    function initList(currentSession) {\n      //noinspection JSUnresolvedFunction\n      $(\"#list-container\").kendoWindow({\n        actions:  [\"Minimize\", \"Maximize\", \"Close\"],\n        position: {\n          top:  '65px',\n          left: '10px'\n        },\n        width:    '40%'\n      });\n      var panel = $(\"#list-container\").data(\"kendoWindow\");\n      panel.pin();\n      panel.title(\"Реестр объектов\");\n      panel.close();\n      var data = [];\n      \n      var classes = [];\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        \n        var layerName = coreConfig.editors[i].id;\n        var key = currentSession.attributes.userGroup + \".\" + currentSession.attributes.userRole;\n        var roleEditors = coreConfig.roles[key][\"editors\"];\n        var flag = roleEditors.some(function (item) {\n          return item == layerName\n        });\n        \n        if ((coreConfig.editors[i].editable == true) && (flag == true)) classes.push(store.editors[i])\n      }\n      var classAliases = {};\n      for (var i = 0; i < classes.length; i++) {\n        var className = classes[i].id;\n        var dataItem = {\n          name:  className,\n          alias: db[className].classAlias\n        };\n        classAliases[className] = db[className].classAlias;\n        data.push(dataItem);\n      }\n      \n      forms.createComboBox(\"classSelection\", data, \"name\", \"alias\");\n      var select = $(\"#classSelection\").data(\"kendoComboBox\");\n      $(\"#showFeatureTableButton\").click(function () {\n        var selectedClassName = select.value();\n        var elementName = addFeatureTableTab(classAliases[selectedClassName]) + \"-table\";\n        logic.initFeatureList(selectedClassName, elementName);\n        \n        //toDo\n        $(document).on('afterFilter', function (event, params, dataSource) {\n          console.log(params);\n          var editorLayer = _getEditorLayer(selectedClassName);\n          var where = \"1=1\";\n          if (params !== null) where = getWhere(params);\n          console.log(\"className=\" + selectedClassName, \"where=\" + where);\n          editorLayer.setDefinitionExpression(where);\n          editorLayer.refresh();\n          \n          /*if (params !== null && params.hasOwnProperty('overrideEvent') && params.overrideEvent === true) {\n           console.log(\"did not fire\")\n           } else if (params !== null && $.isEmptyObject(params) === false) {\n           console.log(\"p\", params)\n           } else if (params === null || $.isEmptyObject(params) === true) {\n           console.log(\"cleared\");\n           }*/\n        });\n        \n      })\n    }\n    \n    function getWhere(params) {\n      var filters = params.filters;\n      var where = \"\";\n      var clauses = [];\n      for (var i = 0; i < filters.length; i++) {\n        var filter = filters[i];\n        var field = filter.field;\n        var operator = getOperator(filter.operator);\n        var value = getQueryValue(filter.value);\n        switch (operator.baseOperator) {\n          case \"startswith\":\n            value = \"'\" + filter.value + \"%'\";\n            break;\n          case \"contains\":\n            value = \"'%\" + filter.value + \"%'\";\n            break;\n          case \"doesnotcontain\":\n            value = \"'%\" + filter.value + \"%'\";\n            break;\n          case \"endswith\":\n            value = \"'%\" + filter.value + \"'\";\n            break;\n        }\n        var partWhere = field + operator.finalOperator + value;\n        clauses.push(partWhere);\n      }\n      where = clauses.join(\" AND \");\n      return where;\n    }\n    \n    function getOperator(operator) {\n      var operators = {\n        \"neq\":            \" <> \",\n        \"eq\":             \" = \",\n        \"gt\":             \" > \",\n        \"lt:\":            \" < \",\n        \"gte\":            \" >= \",\n        \"lte\":            \" <= \",\n        \"startswith\":     \" like \",\n        \"contains\":       \" like \",\n        \"doesnotcontain\": \" not like \",\n        \"endswith\":       \" like \"\n      };\n      return {baseOperator: operator, finalOperator: operators[operator]};\n    }\n    \n    function getQueryValue(data) {\n      var typeValue = typeof data;\n      var value;\n      switch (typeValue) {\n        case \"string\":\n          value = \"'\" + data + \"'\";\n          break;\n        case \"number\":\n          value = data;\n          break;\n        case \"object\":\n          value = \"'\" + moment(data).format() + \"'\";\n          break;\n      }\n      return value;\n    }\n    \n    function addFeatureTableTab(title) {\n      var tabsElementName = \"featureTable-tabs\";\n      var containerElementName = \"featureTable-container\";\n      var tabsElement = $(\"#\" + tabsElementName)[0];\n      var containerElement = $(\"#\" + containerElementName)[0];\n      var itemName = \"featureTable-\" + Date.now();\n      var tabHTML = \"\" +\n        \"<li>\" +\n        \"<a id='\" + itemName + \"-tab' data-toggle='tab' href='#\" + itemName + \" ' >\" +\n        title +\n        \"</a>\" +\n        \"</li>\";\n      tabsElement.innerHTML += tabHTML;\n      var containerDiv = document.createElement(\"div\");\n      containerDiv.className = \"tab-pane clear-padding\";\n      containerDiv.id = itemName;\n      containerDiv.innerHTML += \"<div id='\" + itemName + \"-table'></div>\";\n      containerDiv.innerHTML += \"<div id='\" + itemName + \"-where'></div>\";\n      containerElement.appendChild(containerDiv);\n      \n      return itemName;\n    }\n    \n    function initTreeIdentifiedObject() {\n      return;\n      //noinspection JSUnresolvedFunction\n      $(\"#tree-container\").kendoWindow({\n        actions:  [\"Minimize\", \"Maximize\", \"Close\"],\n        position: {\n          top:  65,\n          left: '10px'\n        },\n        width:    '20%'\n      });\n      var panel = $(\"#tree-container\").data(\"kendoWindow\");\n      panel.pin();\n      panel.title(\"Иерархия объектов\");\n      panel.open();\n      \n      store.treeModel = new Memory({\n        data:        [\n          {id: 'root', name: 'Сетевая организация', type: 'planet', population: '6 billion'}\n        ],\n        getChildren: function (object) {\n          return this.query({parent: object.id});\n        }\n      });\n      \n      store.treeModel = new Observable(store.treeModel);\n      \n      // Create the model\n      var myModel = new ObjectStoreModel({\n        store: store.treeModel,\n        query: {id: 'root'}\n      });\n      \n      // Create the Tree.\n      var tree = new Tree({\n        model:    myModel,\n        showRoot: false\n      });\n      \n      tree.placeAt(\"tree-IdentifyObject\");\n      tree.startup();\n      \n      map.on(\"extent-change\", updateControls)\n    }\n    \n    function featuresToTreeModel(data, className) {\n      var features = data.features;\n      for (var i = 0; i < features.length; i++) {\n        var root = 'root';\n        var feature = features[i];\n        var attrs = feature.attributes;\n        \n        var company = root + \"-company-\" + attrs[\"company\"];\n        if (_isEmptyNode(company)) store.treeModel.add({\n          id:     company,\n          name:   _getNodeName(\"company\", attrs),\n          type:   'company',\n          parent: root\n        });\n        \n        var branch = company + \"-branch-\" + attrs[\"branch\"];\n        if (_isEmptyNode(branch))  store.treeModel.add({\n          id:     branch,\n          name:   _getNodeName(\"branch\", attrs),\n          type:   'branch',\n          parent: company\n        });\n        \n        var gridArea = branch + \"-gridArea-\" + attrs[\"gridArea\"];\n        if (_isEmptyNode(gridArea)) store.treeModel.add({\n          id:     gridArea,\n          name:   _getNodeName(\"gridArea\", attrs),\n          type:   'gridArea',\n          parent: branch\n        });\n        \n        var gridSector = gridArea + \"-gridSector-\" + attrs[\"gridSector\"];\n        if (_isEmptyNode(gridSector)) store.treeModel.add({\n          id:     gridSector,\n          name:   _getNodeName(\"gridSector\", attrs),\n          type:   'gridSector',\n          parent: gridArea\n        });\n        \n        var classNode = gridSector + \"-\" + className;\n        if (_isEmptyNode(classNode)) store.treeModel.add({\n          id:     classNode,\n          name:   coreConfig.translation[className].alias,\n          type:   className,\n          parent: gridSector\n        });\n        \n        var leaf = classNode + \"-\" + attrs[\"localName\"];\n        if (_isEmptyNode(leaf)) store.treeModel.add({\n          id:     leaf,\n          name:   attrs[\"localName\"],\n          type:   'leaf',\n          parent: classNode\n        });\n      }\n      \n      function _isEmptyNode(id) {\n        return store.treeModel.query({id: id}).length == 0;\n      }\n      \n      function _getNodeName(name, value) {\n        if ((value[name] == null) || (value[name] === undefined)) {\n          return coreConfig.translation[name].alias;\n        }\n        return value[name];\n      }\n      \n    }\n    \n    function updateControls(e) {\n      db.Substation\n        .getByGeometry({where: \"1=1\", geometry: map.extent})\n        .then(function (data) {\n          featuresToTreeModel(data, \"Substation\");\n        });\n      db.ACLineSegment\n        .getByGeometry({where: \"1=1\", geometry: map.extent})\n        .then(function (data) {\n          featuresToTreeModel(data, \"ACLineSegment\");\n        });\n      db.Switch\n        .getByGeometry({where: \"1=1\", geometry: map.extent})\n        .then(function (data) {\n          featuresToTreeModel(data, \"Switch\");\n        })\n    }\n    \n    function initSearchControl() {\n      var _searchControl = new Search({\n        enableButtonMode:       false, //this enables the search widget to display as a single button\n        enableInfoWindow:       false,\n        showInfoWindowOnSelect: false,\n        enableHighlight:        true,\n        enableLabel:            true,\n        map:                    map\n      }, \"searchField\");\n      \n      var sources = _searchControl.get(\"sources\");\n      \n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        sources.push({\n          featureLayer:      new FeatureLayer(coreConfig.editors[i].url),\n          searchFields:      coreConfig.editors[i].searchFields,\n          displayField:      coreConfig.editors[i].searchFields[0],\n          exactMatch:        coreConfig.search.exactMatch,\n          outFields:         coreConfig.editors[i].searchFields,\n          name:              coreConfig.editors[i].alias,\n          placeholder:       coreConfig.editors[i].placeholder,\n          maxResults:        coreConfig.search.maxResults,\n          maxSuggestions:    coreConfig.search.maxSuggestions,\n          enableSuggestions: coreConfig.search.enableSuggestions,\n          minCharacters:     coreConfig.minCharacters\n        });\n      }\n      \n      _searchControl.set(\"sources\", sources);\n      _searchControl.startup();\n    }\n    \n    function initBaseMapList() {\n      var vectorLayer = new VectorTileLayer(\"http://www.arcgis.com/sharing/rest/content/items/f96366254a564adda1dc468b447ed956/resources/styles/root.json\", {\n        id:         \"Векторная подложка\",\n        visibility: false,\n      });\n      var osmLayer = map.getLayer(\"osm\");\n      var spaceLayer = map.getLayer(\"hybrid\");\n      var defLayer = map.getLayer(\"layer0\");\n      $(\"#basemapList li\").click(function (e) {\n        switch (e.target.text) {\n          case \"Космоснимки\":\n            vectorLayer.setVisibility(false);\n            map.setBasemap(\"hybrid\");\n            break;\n          case \"Осветленная карта\":\n            vectorLayer.setVisibility(false);\n            map.setBasemap(\"gray\");\n            break;\n          case \"Open Street Map\":\n            vectorLayer.setVisibility(false);\n            map.setBasemap(\"osm\");\n            break;\n          case \"Векторная карта\":\n            map.addLayer(vectorLayer);\n            vectorLayer.setVisibility(true);\n            osmLayer.setVisibility(false);\n            spaceLayer.setVisibility(false);\n            defLayer.setVisibility(false);\n            break;\n        }\n      });\n      \n      function setVisibleVectorLayer(status) {\n        if (status == true) {\n          \n        }\n        else {\n        }\n      }\n    }\n    \n    function initLayerList() {\n      var layerList = new LayerList({\n        map:       map,\n        layers:    null,\n        subLayers: true\n      }, \"layersDiv\");\n      layerList.startup();\n    }\n    \n    function initScaleBar() {\n      new Scalebar({\n        map:          map,\n        scalebarUnit: \"metric\"\n      });\n    }\n    \n    function loadEditorHandlers() {\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        loadEditorHandler(coreConfig.editors[i].id);\n      }\n    }\n    \n    function loadEditorHandler(id) {\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        if (coreConfig.editors[i].id == id) {\n          coreConfig.editors[i].editorHandler = logic.getEditorHandler(id);\n          coreConfig.editors[i].clickHandler = logic.getClickHandler(id);\n          break;\n        }\n      }\n    }\n    \n    function loadDictionaryEnum(dictionaryName, url, field, where) {\n      idb.get(\"dict_\" + dictionaryName)\n        .then(function (doc) {\n          store.dicts[dictionaryName] = [];\n          store.dicts[dictionaryName] = doc.data;\n          forms.showNotify(\" классификатор \" + dictionaryName + \" взят из кэша приложения\", \"info\");\n        })\n        .catch(function (err) {\n          var dictionary = new model({url: url, className: \"\"});\n          dictionary.getDictionary({where: where}, [field]).then(_innerLoader);\n        });\n      \n      function _innerLoader(data) {\n        var features = data.features;\n        var result = featuresPropertyToArray(features, field);\n        store.dicts[dictionaryName] = [];\n        store.dicts[dictionaryName] = result;\n        idb.put({\n          _id:   \"dict_\" + dictionaryName,\n          title: \"dict_\" + dictionaryName,\n          data:  result\n        }).then(function (response) {\n          // handle response\n          console.log(response);\n        }).catch(function (err) {\n          console.log(err);\n        });\n        forms.showNotify(\" загружен классификатор \" + dictionaryName, \"info\");\n      }\n    }\n    \n    function loadDictionaries() {\n      return new Promise(function (resolve, reject) {\n        // загрузка словарей (для уменьшения нагрузки в дальнейшем\n        for (var i = 0; i < coreConfig.dicts.length; i++) {\n          loadDictionaryEnum(coreConfig.dicts[i].id, coreConfig.dicts[i].url, coreConfig.dicts[i].field, coreConfig.dicts[i].where);\n        }\n        resolve(\"success\");\n      });\n      \n    }\n    \n    function updateDictionaryEnum(dictionaryName, url, where) {\n      var dictionary = new model({className: dictionaryName, url: url});\n      return dictionary.get({where: where})\n    }\n    \n    function getDictionaryIdValue(url, fieldName, value) {\n      var dictionary = new model({className: \"\", url: url});\n      return dictionary.get({where: fieldName + \" = '\" + value + \"'\"});\n    }\n    \n    function getCascade(url, selectedValue, selectedFieldName, parentKey, chieldKey) {\n      var dictionary = new model({className: \"\", url: url});\n      var where = \"\";\n      if (selectedFieldName != null) {\n        where = selectedFieldName + \"='\" + selectedValue + \"'\";\n      }\n      return dictionary\n        .get({where: where}) // получаем объект по значению списка\n        .then(function (data) {\n          var feature = context.first(data);\n          var value = feature.attributes[chieldKey];\n          var innerWhere = parentKey + \"=\" + value;\n          return dictionary.get({where: innerWhere}); //получаем объект по\n        })\n    }\n    \n    function initEditor(evt, currentSession) {\n      var templateLayers = [];\n      for (var i = 0; i < coreConfig.editors.length; i++) {\n        \n        var layerName = coreConfig.editors[i].id;\n        var key = currentSession.attributes.userGroup + \".\" + currentSession.attributes.userRole;\n        var roleEditors = coreConfig.roles[key][\"editors\"];\n        var flag = roleEditors.some(function (item) {\n          return item == layerName\n        });\n        \n        if ((coreConfig.editors[i].editable == true) && (flag == true)) templateLayers.push(store.editors[i])\n      }\n      var templatePicker = new TemplatePicker({\n        featureLayers: templateLayers,\n        grouping:      true,\n        rows:          \"auto\",\n        columns:       5,\n        showTooltip:   true,\n      }, \"templateDiv\");\n      templatePicker.startup();\n      \n      var layers = arrayUtils.map(evt.layers, function (result) {\n        return {featureLayer: result.layer};\n      });\n      \n      var layersInfos = [];\n      for (var i = 0; i < layers.length; i++) {\n        var layerInfo = layers[i];\n        layerInfo.disableAttributeUpdate = true;\n        layersInfos.push(layerInfo);\n      }\n      \n      var undoManager = new UndoManager({maxOperations: 100});\n      \n      /** @namespace Editor.CREATE_TOOL_POLYGON */\n      /** @namespace Editor.CREATE_TOOL_POLYLINE */\n      var settings = {\n        enableUndoRedo:        true,\n        maxUndoRedoOperations: 100,\n        map:                   map,\n        templatePicker:        templatePicker,\n        layerInfos:            layersInfos,\n        toolbarVisible:        true,\n        createOptions:         {\n          polylineDrawTools: [Editor.CREATE_TOOL_POLYLINE],\n          polygonDrawTools:  [Editor.CREATE_TOOL_POLYGON]\n        },\n        toolbarOptions:        {\n          reshapeVisible: true,\n          cutVisible:     true,\n          mergeVisible:   true\n        },\n        undoManager:           undoManager\n      };\n      \n      var params = {settings: settings};\n      var _editor = new Editor(params, 'editorDiv');\n      var symbol = new SimpleMarkerSymbol(\n        SimpleMarkerSymbol.STYLE_CROSS,\n        25,\n        new SimpleLineSymbol(\n          SimpleLineSymbol.STYLE_SOLID,\n          new Color([50, 0, 200, 0.8]),\n          3\n        ),\n        null\n      );\n      map.enableSnapping({\n        alwaysSnap:      true,\n        snapPointSymbol: symbol,\n        tolerance:       25,\n        snapKey:         17\n      });\n      \n      _editor.startup();\n      forms.hideWindow(\"editor-container\");\n    }\n    \n    function initPouchDB() {\n      return new Promise(function (resolve, reject) {\n        idb = new PouchDB('idb', {adapter: \"idb\"});\n        resolve(\"success\");\n      });\n    }\n    \n    function saveColumnState(className, columnName, state) {\n      return idb.upsert(className + \"_columns\", function (doc) {\n        if (doc.data) {\n          doc.data[columnName] = state;\n        }\n        else {\n          doc.data = {};\n          doc.data[columnName] = state;\n        }\n        return doc;\n      })\n    }\n    \n    function getColumnsState(className) {\n      return idb.get(className + \"_columns\");\n    }\n    \n    function initVoltageLevelGeneration() {\n      bindClick(\"voltageLevelGeneration\", function () {\n        return db.Substation\n          .getIds({where: \"1=1\"})\n          .then(function (data) {\n            var ids = data;\n            var i = 0;\n            var interval = setInterval(function () {\n              if (i == ids.length) {\n                interval = 0;\n              }\n              generateVoltageLevel(ids[i]);\n              i++;\n            }, 200);\n          })\n      });\n      \n      function generateVoltageLevel(substationId) {\n        var substation = {};\n        return db.Substation.getById(substationId)\n          .then(function (data) {\n            substation = context.first(data);\n            return db.EquipmentContainer.get({where: context.containerWhere(\"Substation\", \"VoltageLevel\", substationId)})\n          })\n          .then(function (data) {\n            var features = context.all(data);\n            if (features.length == 0) {\n              db.ACLineSegment.getByGeometry({where: \"1=1\", geometry: substation.geometry, distance: 1})\n                .then(function (data) {\n                    var segments = context.all(data);\n                    var voltages = segments.map(function (item) { return item.attributes.nominalVoltage});\n                    voltages = distinct(voltages);\n                    console.log('Создаем коллекцию РУ для ', substation.attributes.localName);\n                    console.log('Сегменты', segments);\n                    console.log('Напряжения', voltages);\n                    for (var i = 0; i < voltages.length; i++) {\n                      if (voltages[i] !== undefined) {\n                        var voltageLevel = {\n                          attributes: {\n                            localName:      \"РУ-\" + voltages[i] + \"кВ\",\n                            aliasName:      \"РУ-\" + voltages[i] + \"кВ\",\n                            assetType:      \"распределительное устройство\",\n                            nominalVoltage: voltages[i]\n                          },\n                          geometry:   substation.geometry\n                        };\n                        console.log('Создается РУ для ' + voltages[i] + \" кВ\");\n                        db.VoltageLevel.add(voltageLevel)\n                          .then(function (data) {\n                            var chieldMRID = data[0][0].objectId;\n                            var container = {\n                              attributes: {\n                                parentMRID:      substationId,\n                                chieldMRID:      chieldMRID,\n                                parentClassName: \"Substation\",\n                                chieldClassName: \"VoltageLevel\"\n                              },\n                              geometry:   substation.geometry\n                            };\n                            db.EquipmentContainer.add(container)\n                              .then(function () {\n                                console.log('Создано РУ на ПС ' + substation.attributes.localName)\n                              })\n                          })\n                      }\n                    }\n                  }\n                )\n            } else {\n              console.log('На подстанции ' + substation.attributes.localName + \" уже \" + features.length + \" РУ\", features);\n            }\n          })\n      }\n    }\n    \n    function initACLineSegmentVoltageLevelConnection() {\n      bindClick(\"acLineSegmentVoltageLevelConnection\", function () {\n        return db.ACLineSegment\n          .getIds({where: \"1=1\"})\n          .then(function (data) {\n            var ids = data;\n            var i = 0;\n            var interval = setInterval(function () {\n              if (i == ids.length) {\n                interval = 0;\n              }\n              acLineSegmentVoltageLevelConnect(ids[i], 1);\n              acLineSegmentVoltageLevelConnect(ids[i], 2);\n              i++;\n            }, 500);\n          })\n      });\n      \n      function acLineSegmentVoltageLevelConnect(parentId, terminalNumber) {\n        var where = \"parentClassName='ACLineSegment' AND chieldClassName='VoltageLevel' AND parentMRID=\" + parentId;\n        return db.AssetContainer.get({where: where})\n          .then(function (data) {\n            var features = context.all(data);\n            var hasTerminals = features.some(function (item) {\n              var attributes = item.attributes;\n              var terminal = Number(attributes.localName.replace(\"terminal\", \"\"));\n              return terminal == terminalNumber;\n            });\n            if ((features.length !== 0) || (hasTerminals == true)) {\n              console.log(\"\");\n              console.log(\"Сегмент [\" + parentId + \"], терминал [\" + terminalNumber + \"] -> \" + features.length + \" связей с РУ\");\n              console.log(\"\");\n            }\n            else {\n              var acLineSegment = {};\n              db.ACLineSegment\n                .getById(parentId)\n                .then(function (data) {\n                  acLineSegment = context.first(data);\n                  var point = terminalNumber === 1 ? carto.getFirstPointInLine(acLineSegment.geometry) : carto.getLastPointInLine(acLineSegment.geometry);\n                  db.VoltageLevel.getByGeometry({where: \"1=1\", geometry: point, distance: 1})\n                    .then(function (data) {\n                      var voltageLevels = context.all(data);\n                      console.log(\"\");\n                      console.log(\"Сегмент [\" + parentId + \"] имеет \" + voltageLevels.length + \" пересечений\");\n                      \n                      var targetVoltageLevel = voltageLevels.find(function (item) {\n                        return item.attributes.nominalVoltage == acLineSegment.attributes.nominalVoltage;\n                      });\n                      console.log(\"Целевой id РУ -\" + targetVoltageLevel.attributes.OBJECTID);\n                      console.log(\"\");\n                      var point = terminalNumber === 1 ? carto.getFirstPointInLine(acLineSegment.geometry) : carto.getLastPointInLine(acLineSegment.geometry);\n                      var topologyNode = {\n                        attributes: {\n                          localName:       \"terminal\" + terminalNumber,\n                          parentClassName: \"ACLineSegment\",\n                          chieldClassName: \"VoltageLevel\",\n                          parentMRID:      parentId,\n                          chieldMRID:      targetVoltageLevel.attributes.OBJECTID\n                        },\n                        geometry:   point\n                      };\n                      db.AssetContainer.add(topologyNode).then(function (data) {\n                        console.log(\"Связь Segment[\" + acLineSegment.attributes.localName + \"] - VL[\" + targetVoltageLevel.attributes.OBJECTID + \"] -> id=\" + data[0][0].objectId);\n                      });\n                    })\n                })\n            }\n          })\n        \n      }\n    }\n    \n    async function initApplicationTesting() {\n      bindClick(\"applicationTesting\", testCase1);\n      async function testCase1() {\n        var substations = await (db.Substation.get({where: \"1=1\"}));\n        var powerLines = await (db.Account.get({where: \"1=1\"}));\n        var structures = db.Structure.getAsync({where: \"1=1\"});\n        console.log(substations, powerLines, structures);\n        return {substations: substations, powerLines: powerLines};\n      }\n    }\n    \n    async function initPilotGPS() {\n      var baseUrl = \"https://ya.ru\";\n      bindClick(\"pilotGPSMessages\", async function () {\n        var data = await (getPilotGPSList(baseUrl));\n        var element = $(\"#pilotGpsData\");\n        console.log(element);\n      })\n    }\n    \n    async function getPilotGPSList(baseUrl) {\n      var data = await (getUrl(baseUrl, {\n        handleAs: \"html\"\n      }));\n      console.log(data);\n    }\n    \n    async function getUrl(url, params) {\n      return new Promise(function (resolve) {\n        request(url, params).then(function (data) { resolve.data });\n      })\n    }\n    \n    return {\n      initLoginWindow:           initLoginWindow,\n      initPouchDB:               initPouchDB,\n      createFeatureLayer:        createFeatureLayer,\n      initEditor:                initEditor,\n      loadVectorLayers:          loadVectorLayers,\n      loadEditorLayers:          loadEditorLayers,\n      loadControls:              loadControls,\n      loadEditorHandlers:        loadEditorHandlers,\n      loadDictionaryEnum:        loadDictionaryEnum,\n      loadDictionaries:          loadDictionaries,\n      loadDB:                    loadDB,\n      initTableFeatureLayer:     initTableFeatureLayer,\n      initList:                  initList,\n      updateDictionaryEnum:      updateDictionaryEnum,\n      getDictionaryIdValue:      getDictionaryIdValue,\n      getCascade:                getCascade,\n      bindClick:                 bindClick,\n      saveColumnState:           saveColumnState,\n      getColumnsState:           getColumnsState,\n      initPilotGPS:              initPilotGPS\n    }\n  }\n)\n;\n"]}