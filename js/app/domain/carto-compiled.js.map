{"version":3,"sources":["carto.js"],"names":[],"mappings":"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","file":"carto-compiled.js","sourcesContent":["/**\n * Created by udaltsov on 11.12.15.\n */\n\"use strict\";\ndefine([\n        \"esri/geometry/Extent\",\n        \"esri/geometry/Point\",\n        \"esri/geometry/Polygon\",\n        \"esri/geometry/Polyline\",\n        \"esri/SpatialReference\",\n        \"esri/Color\",\n        \"esri/symbols/SimpleMarkerSymbol\",\n        \"esri/symbols/PictureMarkerSymbol\",\n        \"esri/symbols/SimpleLineSymbol\",\n        \"esri/symbols/SimpleFillSymbol\",\n        \"esri/renderers/UniqueValueRenderer\",\n        \"esri/renderers/ScaleDependentRenderer\",\n        \"esri/graphic\",\n        \"esri/geometry/geometryEngine\",\n        \"esri/geometry/webMercatorUtils\",\n        \"esri/tasks/PrintTask\",\n        \"esri/tasks/PrintParameters\",\n        \"esri/tasks/PrintTemplate\",\n        \"esri/map\"\n    ],\n    function (Extent,\n              Point,\n              Polygon,\n              Polyline,\n              SpatialReference,\n              Color,\n              SimpleMarkerSymbol,\n              PictureMarkerSymbol,\n              SimpleLineSymbol,\n              SimpleFillSymbol,\n              UniqueValueRenderer,\n              ScaleDependentRenderer,\n              Graphic,\n              geometryEngine,\n              webMercatorUtils,\n              PrintTask,\n              PrintParameters,\n              PrintTemplate,\n              Map) {\n\n        function addGraphic(feature, symbol) {\n            var currentSymbol = symbol;\n            if (currentSymbol === undefined) {\n                currentSymbol = getDefaultSumbol(feature.geometry);\n            }\n            var graphic = new Graphic(feature.geometry, currentSymbol, null, null);\n            map.graphics.add(graphic);\n        }\n\n        function addGraphicToMap(mapObject, feature, symbol, center, zoom) {\n            var currentSymbol = symbol;\n            if (currentSymbol === undefined) {\n                currentSymbol = getDefaultSumbol(feature.geometry);\n            }\n            var graphic = new Graphic(feature.geometry, currentSymbol, null, null);\n            mapObject.graphics.add(graphic);\n            if ((center) && (zoom)) {\n                mapObject.centerAndZoom(getCenterFromExtent(getFeatureExtent(feature.geometry)), zoom);\n            }\n        }\n\n        function getDefaultSumbol(geometry) {\n            var symbol = null;\n            switch (geometry.type) {\n                case 'point':\n                    symbol = new PictureMarkerSymbol('images/marker.png', 20, 20).setOffset(0, 10);\n                    break;\n                case 'polyline':\n                    symbol = new SimpleLineSymbol();\n                    break;\n                case 'polygon':\n                    symbol = new SimpleFillSymbol();\n                    break;\n            }\n            return symbol;\n        }\n\n        function addGpxGraphic(feature) {\n            addGraphic(feature, getDefaultSymbol(\"point\"));\n        }\n\n        function getDefaultSymbol(geometryType) {\n            switch (geometryType) {\n                case \"point\":\n                    var symbol = new PictureMarkerSymbol('images/marker.png', 20, 20).setOffset(0, 10);\n                    return symbol;\n                    break;\n            }\n        }\n\n        function deleteGpxPoints() {\n            map.graphics.clear();\n        }\n\n        function getUniqueRenderer(info, scale) {\n            var size;\n\n            if (scale == undefined) {\n                size = Math.pow(map.getZoom(), 1.35) / (2.3 * map.getMaxZoom());\n            }\n\n            var defaultSymbol = new PictureMarkerSymbol(\"images/renderers/\" + info.defaultSymbol.url, info.defaultSymbol.height * size, info.defaultSymbol.width * size);\n            if ((info.defaultSymbol.xoffset !== undefined) && (info.defaultSymbol.yoffset !== undefined)) {\n                defaultSymbol.setOffset(info.defaultSymbol.xoffset, info.defaultSymbol.yoffset);\n            }\n            var renderer = new UniqueValueRenderer(defaultSymbol, info.attributeField, info.attributeField2, info.attributeField3, '!');\n            var values = info.values;\n            for (var i = 0; i < values.length; i++) {\n                var valueSymbol = new PictureMarkerSymbol(\"images/renderers/\" + values[i].symbol.url, values[i].symbol.height * size, values[i].symbol.width * size);\n                if ((values[i].symbol.xoffset !== undefined) && (values[i].symbol.yoffset !== undefined)) {\n                    valueSymbol.setOffset(values[i].symbol.xoffset, values[i].symbol.yoffset);\n                }\n                renderer.addValue({\n                    description: values[i].label,\n                    symbol: valueSymbol,\n                    label: values[i].label,\n                    value: values[i].value\n                })\n            }\n            return renderer;\n        }\n\n        function getScaleDenepndedRendererInfo(info) {\n            var rendererInfo = {};\n            rendererInfo.renderer = getUniqueRenderer(info);\n            rendererInfo.minScale = info.minScale;\n            rendererInfo.maxScale = info.maxScale;\n            return rendererInfo;\n        }\n\n        function getScaledDependedRenderer(renderers) {\n            var renderer = new ScaleDependentRenderer();\n            for (var i = 0; i < renderers.length; i++) {\n                renderer.addRendererInfo(renderers[i]);\n            }\n            return renderer;\n        }\n\n        function getFirstPointInLine(polyline) {\n            return polyline.getPoint(0, 0);\n        };\n\n        function getLastPointInLine(polyline) {\n            var point = polyline.getPoint(0, polyline.paths[0].length - 1);\n            return point;\n        };\n\n        function getNPointInLine(polyline, n) {\n            return getNPointInLineInPath(polyline, 0, n);\n        }\n\n        function getNPointInLineInPath(polyline, pathNumber, pointNumber) {\n            var point = polyline.getPoint(pathNumber, pointNumber);\n            return point;\n        }\n\n        function sumLineGeometry(data) {\n            var geometry = new Polyline(new SpatialReference({wkid: 102100}));\n            var features = data;\n            for (var i = 0; i < features.length; i++) {\n                var feature = features[i];\n                for (var j = 0; j < feature.geometry.paths.length; j++) {\n                    geometry.addPath(feature.geometry.paths[j])\n                }\n            }\n            return geometry;\n        };\n\n        function getCenter(extent) {\n            var x = (extent.xmin + extent.xmax) / 2;\n            var y = (extent.ymin + extent.ymax) / 2;\n            return new Point(x, y, new SpatialReference({wkid: 102100}));\n        };\n\n        function getFeatureExtent(geometry) {\n            var bbox;\n            switch (geometry.type) {\n                case \"point\":\n                    bbox = geometryEngine.buffer(geometry, 10, 9001, true);\n                    bbox = bbox.getExtent();\n                    break;\n                case \"polyline\":\n                    bbox = geometry.getExtent();\n                    break;\n                case \"polygon\":\n                    break;\n                    bbox = geometry.getExtent();\n            }\n            return bbox;\n        }\n\n        function updateLineByPoint(lineGeom, oldPoint, newPoint) {\n            //noinspection JSUnresolvedFunction\n            var vertex = geometryEngine.nearestVertex(lineGeom, oldPoint);\n            var index = vertex.vertexIndex;\n            lineGeom.setPoint(0, index, newPoint);\n            return lineGeom;\n        };\n\n        function toMercator(x, y) {\n            var point = new Point(x, y, new SpatialReference({wkid: 3857}));\n            return webMercatorUtils.geographicToWebMercator(point);\n        }\n\n        function toWgs84(point) {\n            var result = webMercatorUtils.webMercatorToGeographic(point);\n            return result;\n        }\n\n        function refreshLayer(id) {\n            var layer = _getEditorLayer(id);\n            layer.refresh();\n        }\n\n        function addGpxGraphicsToMap(features) {\n            var mapFeatures = features;\n            for (var i = 0; i < mapFeatures.length; i++) {\n                mapFeatures[i].geometry = toMercator(mapFeatures[i].geometry.x, mapFeatures[i].geometry.y);\n            }\n            for (var i = 0; i < features.length; i++) {\n                addGpxGraphic(mapFeatures[i]);\n            }\n        }\n\n        function parseGeoJSON(geoJson) {\n            var result = [];\n            for (var i = 0; i < geoJson.features.length; i++) {\n                if (geoJson.features[i].geometry.type == 'Point') result.push(geoJsonToFeature(geoJson.features[i]));\n            }\n            return result;\n        }\n\n        function geoJsonToFeature(geoJson) {\n            var feature = {};\n            feature.geometry = {\n                \"x\": geoJson.geometry.coordinates[0],\n                \"y\": geoJson.geometry.coordinates[1]\n            };\n            feature.attributes = {\n                name: geoJson.properties.name,\n                desc: geoJson.properties.desc,\n                sym: geoJson.properties.sym,\n                time: geoJson.properties.time,\n                lat: feature.geometry.y,\n                lon: feature.geometry.x\n            };\n\n            return feature;\n        }\n\n        function getGeometryProps(geometry) {\n            try {\n                switch (geometry.type) {\n                    case \"point\":\n                        var point = toWgs84(geometry);\n                        return {lon: point.x, lat: point.y}\n                }\n            }\n            catch (e) {\n                return null;\n            }\n        }\n\n        function getGpxPoint() {\n            return map.extent.getCenter();\n        }\n\n        function getCenterFromExtent(data) {\n            var extent = new Extent(data.xmin, data.ymin, data.xmax, data.ymax, data.spatialReference);\n            return extent.getCenter();\n        }\n\n        function exportMap(data) {\n            var printTask = new PrintTask(data.url, {async: true});\n            var params = new PrintParameters();\n            params.map = map;\n            params.extraParameters = {};\n            params.template = new PrintTemplate();\n            params.template.format = data.imageFormat;\n            params.template.layout = data.paperSize;\n\n            return printTask.execute(params);\n        }\n\n        function createGraphic(data) {\n            return new Graphic(data.geometry, data.symbol, data.attributes, null);\n        }\n\n        function pointsToPolyline(points) {\n            var geometry = new Polyline(points[0].spatialReference);\n            geometry.addPath(points);\n            return geometry;\n        }\n\n        function featureToGeoJson(feature) {\n            var geometry = Terraformer.ArcGIS.parse(webMercatorUtils.webMercatorToGeographic(feature.geometry), {\n                idAttribute: \"OBJECTID\"\n            });\n            return {\n                type: \"Feature\",\n                properties: feature.attributes,\n                geometry: geometry\n            }\n        }\n\n        function exportFeaturesToKML(elementName, className) {\n            var grid = $(\"#\" + elementName).data(\"kendoGrid\");\n            var dataSource = grid.dataSource;\n            var ids = dataSource._data.map(function (item) {\n                return item.OBJECTID\n            });\n            return db[className].getByArray(ids)\n                .then(function (featureSet) {\n                    var data = featureSet.features;\n                    var geoJsonFeatures = data.map(function (item) {\n                        return featureToGeoJson(item);\n                    })\n                    var geoJsonObject = {\n                        type: \"FeatureCollection\",\n                        features: geoJsonFeatures\n                    };\n                    var kml = tokml(geoJsonObject);\n                    var blob = new Blob([kml.toString()], {type: \"text/plain;charset=utf-8\"});\n                    saveAs(blob, \"google.kml\");\n                })\n        }\n\n        function createMap(divElement, params) {\n            var map = new Map(divElement, params);\n            return map;\n        }\n\n        return {\n            addGraphic: addGraphic,\n            addGpxGraphic: addGpxGraphic,\n            deleteGpxPoints: deleteGpxPoints,\n            getUniqueRenderer: getUniqueRenderer,\n            getFirstPointInLine: getFirstPointInLine,\n            getLastPointInLine: getLastPointInLine,\n            getNPointInLine: getNPointInLine,\n            sumLineGeometry: sumLineGeometry,\n            getCenter: getCenter,\n            updateLineByPoint: updateLineByPoint,\n            toMercator: toMercator,\n            toWgs84: toWgs84,\n            refreshLayer: refreshLayer,\n            addGpxGraphicsToMap: addGpxGraphicsToMap,\n            parseGeoJSON: parseGeoJSON,\n            geoJsonToFeature: geoJsonToFeature,\n            getGeometryProps: getGeometryProps,\n            getScaledDependedRenderer: getScaledDependedRenderer,\n            getScaleDenepndedRendererInfo: getScaleDenepndedRendererInfo,\n            getGpxPoint: getGpxPoint,\n            getCenterFromExtent: getCenterFromExtent,\n            exportMap: exportMap,\n            createGraphic: createGraphic,\n            pointsToPolyline: pointsToPolyline,\n            featureToGeoJson: featureToGeoJson,\n            exportFeaturesToKML: exportFeaturesToKML,\n            getFeatureExtent: getFeatureExtent,\n            createMap: createMap,\n            addGraphicToMap: addGraphicToMap,\n            getNPointInLineInPath: getNPointInLineInPath\n        };\n    });"]}