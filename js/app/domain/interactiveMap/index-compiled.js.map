{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/**\r\n * Created by udaltsov on 09.11.15.\r\n */\r\n\"use strict\";\r\n\r\ndefine([\r\n  \"./js/app/dataAccess/model-compiled.js\"\r\n], function (model) {\r\n\r\n  var context = new model({url: null, className: null, map: map});\r\n\r\n  //todo рефакторинг в самое ближайшее время\r\n  function updateTechnicalConnectionInfo() {\r\n    var substationSet = null;\r\n    var equipmentContainerSet = null;\r\n    var voltageLevelSet = null;\r\n    var measurementControlSet = null;\r\n    var substationMeasurementControlSet = null;\r\n    var powerTransformerSet = null;\r\n    var powerTransformerMeasurementControlSet = null;\r\n    var Substations = null;\r\n\r\n    db.Substation\r\n      .get({where: \"assetType = 'центр питания'\"})\r\n      .then(function (data) {\r\n        substationSet = context.all(data);\r\n        var result = [];\r\n        for (var i = 0; i < substationSet.length; i++) {\r\n          var _substation = {\r\n            attributes: {\r\n              Id: substationSet[i].attributes[\"OBJECTID\"],\r\n              Name: substationSet[i].attributes[\"aliasName\"] + \" '\" + substationSet[i].attributes[\"localName\"] + \"'\",\r\n            },\r\n            geometry: substationSet[i].geometry\r\n          };\r\n          result.push(_substation)\r\n        }\r\n        Substations = result;\r\n\r\n        var substationIds = featuresToArray(data, \"OBJECTID\");\r\n        db.EquipmentContainer\r\n          .get({where: \"parentClassName='Substation' AND chieldClassName='VoltageLevel' AND (parentMRID in (\" + substationIds + \"))\"})\r\n          .then(function (data) {\r\n            equipmentContainerSet = context.all(data);\r\n            var voltageLevelIds = featuresToArray(data, \"chieldMRID\");\r\n            return db.VoltageLevel.get({where: \"OBJECTID in (\" + voltageLevelIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            voltageLevelSet = context.all(data);\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              var substationId = Substations[i].attributes[\"Id\"];\r\n              Substations[i].voltageLevels = [];\r\n              for (var j = 0; j < equipmentContainerSet.length; j++) {\r\n                if (equipmentContainerSet[j].attributes[\"parentMRID\"] == substationId) {\r\n                  var voltageLevelId = equipmentContainerSet[j].attributes[\"chieldMRID\"];\r\n                  for (var k = 0; k < voltageLevelSet.length; k++) {\r\n                    if (voltageLevelId == voltageLevelSet[k].attributes[\"OBJECTID\"]) {\r\n                      Substations[i].voltageLevels.push(voltageLevelSet[k]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            console.log(Substations);\r\n            return db.MeasurementContainer.get({where: \"chieldClassName = 'SubstationMeasurementControl' AND parentMRID in (\" + substationIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            measurementControlSet = context.all(data);\r\n            var substationMeasurementControlIds = featuresToArray(data, \"chieldMRID\");\r\n            return db.SubstationMeasurementControl.get({where: \"OBJECTID in (\" + substationMeasurementControlIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            substationMeasurementControlSet = context.all(data);\r\n\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              var substationId = Substations[i].attributes[\"Id\"];\r\n              Substations[i].substationMeasurementControls = [];\r\n              for (var j = 0; j < measurementControlSet.length; j++) {\r\n                if (measurementControlSet[j].attributes[\"parentMRID\"] == substationId) {\r\n                  var substationMeasurementControlId = measurementControlSet[j].attributes[\"chieldMRID\"];\r\n                  for (var k = 0; k < substationMeasurementControlSet.length; k++) {\r\n                    if (substationMeasurementControlId == substationMeasurementControlSet[k].attributes[\"OBJECTID\"]) {\r\n                      Substations[i].substationMeasurementControls.push(substationMeasurementControlSet[k]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            return db.EquipmentContainer.get({where: \"parentClassName='Substation' AND chieldClassName='PowerTransformer' AND parentMRID in (\" + substationIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            var powerTransformerIds = featuresToArray(data, \"chieldMRID\");\r\n            equipmentContainerSet = context.all(data);\r\n            return db.PowerTransformer.get({where: \"OBJECTID in (\" + powerTransformerIds + \")\"})\r\n          })\r\n          .then(function (data) { //add powerTransformers\r\n            powerTransformerSet = context.all(data);\r\n            var powerTransformerIds = featuresToArray(data, \"OBJECTID\");\r\n\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              var substationId = Substations[i].attributes[\"Id\"];\r\n              Substations[i].powerTransformers = [];\r\n              for (var j = 0; j < equipmentContainerSet.length; j++) {\r\n                if (equipmentContainerSet[j].attributes[\"parentMRID\"] == substationId) {\r\n                  var powerTransformerId = equipmentContainerSet[j].attributes[\"chieldMRID\"];\r\n                  for (var k = 0; k < powerTransformerSet.length; k++) {\r\n                    if (powerTransformerId == powerTransformerSet[k].attributes[\"OBJECTID\"]) {\r\n                      Substations[i].powerTransformers.push(powerTransformerSet[k]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n\r\n            console.log(Substations);\r\n            return db.MeasurementContainer\r\n              .get({\r\n                where: \"parentClassName='PowerTransformer' \" +\r\n                \"AND \" +\r\n                \"chieldClassName='PowerTransformerMeasurementControl' \" +\r\n                \"AND \" +\r\n                \"parentMRID in (\" + powerTransformerIds + \")\"\r\n              })\r\n          })\r\n          .then(function (data) {\r\n            measurementControlSet = context.all(data);\r\n            var powerTransformerMeasurementIds = featuresToArray(data, \"chieldMRID\");\r\n            return db.PowerTransformerMeasurementControl\r\n              .get({where: \"OBJECTID in (\" + powerTransformerMeasurementIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            powerTransformerMeasurementControlSet = context.all(data);\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              Substations[i].powerTrasformerMeasurements = [];\r\n              var powerTransformers = Substations[i].powerTransformers;\r\n              for (var j = 0; j < powerTransformers.length; j++) {\r\n                var powerTransformerId = powerTransformers[j].attributes[\"OBJECTID\"];\r\n                for (var k = 0; k < measurementControlSet.length; k++) {\r\n                  var innerPowerTransformerId = measurementControlSet[k].attributes[\"parentMRID\"];\r\n                  var measurementId = measurementControlSet[k].attributes[\"chieldMRID\"];\r\n                  if (powerTransformerId == innerPowerTransformerId) {\r\n                    for (var z = 0; z < powerTransformerMeasurementControlSet.length; z++) {\r\n                      if (measurementId == powerTransformerMeasurementControlSet[z].attributes[\"OBJECTID\"]) {\r\n                        Substations[i].powerTrasformerMeasurements.push(powerTransformerMeasurementControlSet[z]);\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            console.log(Substations);\r\n\r\n            transformSubstationToFeatures(Substations);\r\n\r\n            function transformSubstationToFeatures(substationList) {\r\n              var features = [];\r\n              for (var i = 0; i < substationList.length; i++) {\r\n                var substation = substationList[i];\r\n                substation.attributes[\"Class\"] = _getSubstationClass(substationList[i].voltageLevels);\r\n                substation.attributes[\"Voltage\"] = _getSubstationMaxVoltage(substationList[i].voltageLevels);\r\n                substation.attributes[\"Renovation\"] = _getSubstationRenovation(substationList[i].substationMeasurementControls);\r\n                substation.attributes[\"Power\"] = _getSubstationPower(substationList[i].substationMeasurementControls);\r\n                substation.attributes[\"Status\"] = _getSubstationStatus(substationList[i].powerTransformers, substationList[i].powerTrasformerMeasurements);\r\n                features.push(substation);\r\n              }\r\n\r\n              db.SubstationEnergyCenter\r\n                .addArray(features)\r\n                .then(function (data) {\r\n                  console.log(data);\r\n                })\r\n            }\r\n\r\n\r\n          })\r\n      })\r\n\r\n  }\r\n\r\n  //todo рефакторинг в самое ближайшее время\r\n  function getSubstationEnergyCenterReport(substId) {\r\n    var substationSet = null;\r\n    var equipmentContainerSet = null;\r\n    var voltageLevelSet = null;\r\n    var measurementControlSet = null;\r\n    var substationMeasurementControlSet = null;\r\n    var powerTransformerSet = null;\r\n    var powerTransformerMeasurementControlSet = null;\r\n    var Substations = null;\r\n\r\n    return db.Substation\r\n      .get({where: \"assetType = 'центр питания' AND OBJECTID=\" + substId})\r\n      .then(function (data) {\r\n\r\n        substationSet = context.all(data);\r\n\r\n        var result = [];\r\n        for (var i = 0; i < substationSet.length; i++) {\r\n          var _substation = {\r\n            attributes: {\r\n              Id: substationSet[i].attributes[\"OBJECTID\"],\r\n              Name: substationSet[i].attributes[\"aliasName\"] + \" '\" + substationSet[i].attributes[\"localName\"] + \"'\",\r\n            },\r\n            geometry: substationSet[i].geometry\r\n          };\r\n          result.push(_substation)\r\n        }\r\n        Substations = result;\r\n\r\n        var substationIds = featuresToArray(data, \"OBJECTID\");\r\n        db.EquipmentContainer\r\n          .get({where: \"parentClassName='Substation' AND chieldClassName='VoltageLevel' AND (parentMRID in (\" + substationIds + \"))\"})\r\n          .then(function (data) {\r\n            equipmentContainerSet = context.all(data);\r\n            var voltageLevelIds = featuresToArray(data, \"chieldMRID\");\r\n            return db.VoltageLevel.get({where: \"OBJECTID in (\" + voltageLevelIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            voltageLevelSet = context.all(data);\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              var substationId = Substations[i].attributes[\"Id\"];\r\n              Substations[i].voltageLevels = [];\r\n              for (var j = 0; j < equipmentContainerSet.length; j++) {\r\n                if (equipmentContainerSet[j].attributes[\"parentMRID\"] == substationId) {\r\n                  var voltageLevelId = equipmentContainerSet[j].attributes[\"chieldMRID\"];\r\n                  for (var k = 0; k < voltageLevelSet.length; k++) {\r\n                    if (voltageLevelId == voltageLevelSet[k].attributes[\"OBJECTID\"]) {\r\n                      Substations[i].voltageLevels.push(voltageLevelSet[k]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            console.log(Substations);\r\n            return db.MeasurementContainer.get({where: \"chieldClassName = 'SubstationMeasurementControl' AND parentMRID in (\" + substationIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            measurementControlSet = context.all(data);\r\n            var substationMeasurementControlIds = featuresToArray(data, \"chieldMRID\");\r\n            return db.SubstationMeasurementControl.get({where: \"OBJECTID in (\" + substationMeasurementControlIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            substationMeasurementControlSet = context.all(data);\r\n\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              var substationId = Substations[i].attributes[\"Id\"];\r\n              Substations[i].substationMeasurementControls = [];\r\n              for (var j = 0; j < measurementControlSet.length; j++) {\r\n                if (measurementControlSet[j].attributes[\"parentMRID\"] == substationId) {\r\n                  var substationMeasurementControlId = measurementControlSet[j].attributes[\"chieldMRID\"];\r\n                  for (var k = 0; k < substationMeasurementControlSet.length; k++) {\r\n                    if (substationMeasurementControlId == substationMeasurementControlSet[k].attributes[\"OBJECTID\"]) {\r\n                      Substations[i].substationMeasurementControls.push(substationMeasurementControlSet[k]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            return db.EquipmentContainer.get({where: \"parentClassName='Substation' AND chieldClassName='PowerTransformer' AND parentMRID in (\" + substationIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            var powerTransformerIds = featuresToArray(data, \"chieldMRID\");\r\n            equipmentContainerSet = context.all(data);\r\n            return db.PowerTransformer.get({where: \"OBJECTID in (\" + powerTransformerIds + \")\"})\r\n          })\r\n          .then(function (data) { //add powerTransformers\r\n            powerTransformerSet = context.all(data);\r\n            var powerTransformerIds = featuresToArray(data, \"OBJECTID\");\r\n\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              var substationId = Substations[i].attributes[\"Id\"];\r\n              Substations[i].powerTransformers = [];\r\n              for (var j = 0; j < equipmentContainerSet.length; j++) {\r\n                if (equipmentContainerSet[j].attributes[\"parentMRID\"] == substationId) {\r\n                  var powerTransformerId = equipmentContainerSet[j].attributes[\"chieldMRID\"];\r\n                  for (var k = 0; k < powerTransformerSet.length; k++) {\r\n                    if (powerTransformerId == powerTransformerSet[k].attributes[\"OBJECTID\"]) {\r\n                      Substations[i].powerTransformers.push(powerTransformerSet[k]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n\r\n            return db.MeasurementContainer\r\n              .get({\r\n                where: \"parentClassName='PowerTransformer' \" +\r\n                \"AND \" +\r\n                \"chieldClassName='PowerTransformerMeasurementControl' \" +\r\n                \"AND \" +\r\n                \"parentMRID in (\" + powerTransformerIds + \")\"\r\n              })\r\n          })\r\n          .then(function (data) {\r\n            measurementControlSet = context.all(data);\r\n            var powerTransformerMeasurementIds = featuresToArray(data, \"chieldMRID\");\r\n            return db.PowerTransformerMeasurementControl\r\n              .get({where: \"OBJECTID in (\" + powerTransformerMeasurementIds + \")\"})\r\n          })\r\n          .then(function (data) {\r\n            powerTransformerMeasurementControlSet = context.all(data);\r\n\r\n            for (var i = 0; i < Substations.length; i++) {\r\n              Substations[i].powerTrasformerMeasurements = [];\r\n              var powerTransformers = Substations[i].powerTransformers;\r\n              for (var j = 0; j < powerTransformers.length; j++) {\r\n                var powerTransformerId = powerTransformers[j].attributes[\"OBJECTID\"];\r\n                for (var k = 0; k < measurementControlSet.length; k++) {\r\n                  var innerPowerTransformerId = measurementControlSet[k].attributes[\"parentMRID\"];\r\n                  var measurementId = measurementControlSet[k].attributes[\"chieldMRID\"];\r\n                  if (powerTransformerId == innerPowerTransformerId) {\r\n                    for (var z = 0; z < powerTransformerMeasurementControlSet.length; z++) {\r\n                      if (measurementId == powerTransformerMeasurementControlSet[z].attributes[\"OBJECTID\"]) {\r\n                        powerTransformerMeasurementControlSet[z].attributes[\"aliasName\"] = powerTransformers[j].attributes[\"aliasName\"];\r\n                        Substations[i].powerTrasformerMeasurements.push(powerTransformerMeasurementControlSet[z]);\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n\r\n            generateReport(Substations);\r\n          })\r\n      })\r\n  }\r\n\r\n  function generateReport(substationList) {\r\n    var features = [];\r\n    for (var i = 0; i < substationList.length; i++) {\r\n      var substation = substationList[i];\r\n      substation.attributes[\"Class\"] = _getSubstationClass(substationList[i].voltageLevels);\r\n      substation.attributes[\"Voltage\"] = _getSubstationMaxVoltage(substationList[i].voltageLevels);\r\n      substation.attributes[\"Renovation\"] = _getSubstationRenovation(substationList[i].substationMeasurementControls);\r\n      substation.attributes[\"Power\"] = _getSubstationPower(substationList[i].substationMeasurementControls);\r\n      substation.attributes[\"Status\"] = _getSubstationStatus(substationList[i].powerTransformers, substationList[i].powerTrasformerMeasurements);\r\n      features.push(substation);\r\n    }\r\n\r\n    var item = features[0];\r\n    $(\"#substationName\")[0].innerHTML = item.attributes[\"Name\"];\r\n    $(\"#substationClass\")[0].innerHTML = item.attributes[\"Class\"];\r\n    for (var i = 0; i < item.powerTransformers.length; i++) {\r\n      $(\"#powerTransformer-list\")[0].innerHTML += \"<div>\" + item.powerTransformers[i].attributes[\"aliasName\"] + \" : \" + item.powerTransformers[i].attributes[\"powerRating\"]\r\n    }\r\n\r\n    for (var i = 0; i < item.powerTransformers.length; i++) {\r\n      $(\"#powerTransformerReconstruction-list\")[0].innerHTML += \"<div>\" + item.powerTransformers[i].attributes[\"aliasName\"] + \" : \" + item.powerTransformers[i].attributes[\"altPowerRating\"]\r\n    }\r\n\r\n    $(\"#powerReserve\")[0].innerHTML = item.attributes[\"Power\"];\r\n    $(\"#powerContracts\")[0].innerHTML = item.substationMeasurementControls[0].attributes[\"loadForecastContracts\"];\r\n    $(\"#powerClaims\")[0].innerHTML = item.substationMeasurementControls[0].attributes[\"loadForecastClaims\"];\r\n\r\n    if (item.attributes[\"Renovation\"] > 0) {\r\n      $(\"#reconstruction-header\").show();\r\n      $(\"#powerTransformerReconstruction-list\").show();\r\n      for (var i = 0; i < item.powerTrasformerMeasurements.length; i++) {\r\n        $(\"#powerTransformerLoad-list\")[0].innerHTML += \"<div>\" + item.powerTrasformerMeasurements[i].attributes[\"aliasName\"] + \" : \" + item.powerTrasformerMeasurements[i].attributes[\"loadModeNormal\"]\r\n      }\r\n    }\r\n  }\r\n\r\n  function _getSubstationStatus(_ptSet, _measurements) {\r\n    var measurements = featuresPropertyToArray(_measurements, \"loadModeNormal\");\r\n    var powerTransformers = featuresPropertyToArray(_ptSet, \"powerRating\");\r\n    var sumMeasurements = 0;\r\n    var minPTNominalPower = Infinity;\r\n    for (var j = 0; j < measurements.length; j++) sumMeasurements += Number(measurements[j]);\r\n    for (var k = 0; k < powerTransformers.length; k++) {\r\n      var powerRating = Number(powerTransformers[k]);\r\n      if ((minPTNominalPower > powerRating) && (powerRating != 0 )) {\r\n        minPTNominalPower = Number(powerTransformers[k]);\r\n      }\r\n    }\r\n    var relation = sumMeasurements / (1.05 * minPTNominalPower);\r\n    if (relation < 0.75) return 1;\r\n    if ((relation >= 0.75) && (relation < 1.05)) return 2;\r\n    if (relation >= 1.05) return 3;\r\n  }\r\n\r\n  function _getSubstationClass(voltageLevels) {\r\n    var voltageLevelList = [];\r\n    for (var j = 0; j < voltageLevels.length; j++) {\r\n      voltageLevelList.push(voltageLevels[j].attributes[\"nominalVoltage\"]);\r\n    }\r\n    voltageLevelList = voltageLevelList.sort(function (a, b) {\r\n      return a <= b;\r\n    });\r\n    voltageLevelList = voltageLevelList.join(\"/\");\r\n    return voltageLevelList;\r\n  }\r\n\r\n  function _getSubstationMaxVoltage(voltageLevels) {\r\n    var voltageLevelList = [];\r\n    for (var j = 0; j < voltageLevels.length; j++) {\r\n      voltageLevelList.push(Number(voltageLevels[j].attributes[\"nominalVoltage\"]));\r\n    }\r\n    return Math.max.apply(null, voltageLevelList);\r\n  }\r\n\r\n  function _getSubstationRenovation(measurementControls) {\r\n    for (var j = 0; j < measurementControls.length; j++) {\r\n      if (measurementControls[j].attributes[\"powerInputYear\"] > 0) {\r\n        return 1;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  function _getSubstationPower(measurementControls) {\r\n    for (var j = 0; j < measurementControls.length; j++) {\r\n      if (measurementControls[j].attributes[\"powerReserve1N105\"] > 0) {\r\n        return measurementControls[j].attributes[\"powerReserve1N105\"];\r\n      }\r\n    }\r\n    return NaN;\r\n  }\r\n\r\n  return {\r\n    updateTechnicalConnectionInfo: updateTechnicalConnectionInfo,\r\n    getSubstationEnergyCenterReport: getSubstationEnergyCenterReport,\r\n  };\r\n});"]}