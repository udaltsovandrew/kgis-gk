{"version":3,"sources":["crew.js"],"names":[],"mappings":"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","file":"crew-compiled.js","sourcesContent":["\"use strict\";\r\ndefine([\r\n  \"./js/app/forms/forms-compiled.js\",\r\n  \"./js/app/dataAccess/model-compiled.js\",\r\n  \"./js/app/domain/http-compiled.js\",\r\n  \"./js/app/domain/dxf.js\",\r\n  \"./js/app/domain/features/substation-compiled.js\",\r\n  \"./js/app/domain/features/powerLine-compiled.js\",\r\n  \"./js/app/domain/features/acLineSegment-compiled.js\",\r\n  \"./js/app/domain/features/voltageLevel-compiled.js\",\r\n  \"./js/app/domain/features/powerTransformer-compiled.js\",\r\n  \"./js/app/domain/features/account-compiled.js\",\r\n  \"./js/app/domain/interactiveMap/index.js\",\r\n  \"./js/app/domain/generators-compiled.js\",\r\n  \"./js/app/domain/carto-compiled.js\",\r\n  \"./js/app/domain/misc/sac-compiled.js\",\r\n  \"./js/app/domain/misc/projects-compiled.js\",\r\n  \"./js/app/domain/misc/geometryView-compiled.js\",\r\n  \"./js/app/domain/misc/export-compiled.js\"\r\n], function (forms,\r\n             model,\r\n             httpUtils,\r\n             dxfUtils,\r\n             substation,\r\n             temporaryPowerLine,\r\n             acLineSegment,\r\n             voltageLevel,\r\n             powerTransformer,\r\n             account,\r\n             interactiveMap,\r\n             generators,\r\n             carto,\r\n             sac,\r\n             projects,\r\n             geometryView,\r\n             exportUtils) {\r\n  \r\n  var context = new model({url: \"\", className: \"context\", map: map});\r\n  \r\n  function initCrewTabs(data) {\r\n    var id = context.key(data);\r\n    loadCrewErpPersonList(id);\r\n    loadCrewRouteList(id);\r\n  }\r\n  \r\n  async function loadGuardCrewErpPersonList(id) {\r\n    var table = \"GuardCrew-ErpPerson-List\";\r\n    var tableCandidate = \"GuardCrew-ErpPerson-Candidate-List\";\r\n    \r\n    bindClick(\"linkGuardCrewErpPerson\", async function () {\r\n      var data = await (db.GuardCrew.getById(id));\r\n      var feature = context.first(data);\r\n      var ids = forms.getObjectIDS(tableCandidate);\r\n      var containers = ids.map(function (childId) {\r\n        return {\r\n          geometry: feature.geometry,\r\n          attributes: {\r\n            parentMRID: id,\r\n            parentClassName: \"GuardCrew\",\r\n            chieldClassName: \"ErpPerson\",\r\n            chieldMRID: childId\r\n          }\r\n        }\r\n      });\r\n      var action = await (db.ErpPersonIdentificationObjectRole.addArray(containers));\r\n      if (action) {\r\n        data = await (db.ErpPerson.getByArray(ids));\r\n        features = context.all(data);\r\n        loadGuardCrewErpPersonList(id);\r\n      }\r\n    });\r\n    bindClick(\"relinkGuardCrewErpPerson\", async function () {\r\n      var ids = forms.getObjectIDS(table);\r\n      var chieldIds = \"chieldMRID=\" + ids.join(\" OR chieldMRID=\");\r\n      var where = \"parentMRID=\" + id + \" AND parentClassName='GuardCrew' AND chieldClassName='ErpPerson' AND (\" + chieldIds + \")\";\r\n      var containers = await (db.ErpPersonIdentificationObjectRole.get({where: where}));\r\n      containers = context.all(containers);\r\n      ids = containers.map(function (item) {\r\n        return item.attributes.OBJECTID\r\n      });\r\n      await (db.ErpPersonIdentificationObjectRole.delByArray(ids));\r\n      forms.removeSelectedRows(table);\r\n    });\r\n    \r\n    var features = await (getChields(id, \"GuardCrew\", \"ErpPerson\", \"ErpPersonIdentificationObjectRole\"));\r\n    forms.createTable(table, features, \"ErpPerson\");\r\n    \r\n    var candidates = await (db.ErpPerson.get({where: \"1=1\"}));\r\n    candidates = context.all(candidates);\r\n    forms.createTable(tableCandidate, candidates, \"ErpPerson\");\r\n  }\r\n  \r\n  async function loadCrewRouteList(id) {\r\n    var table = \"Crew-Route-List\";\r\n    var tableCandidate = \"Crew-Route-Candidate-List\";\r\n    \r\n    bindClick(\"linkCrewRoute\", async function () {\r\n      var data = await (db.Crew.getById(id));\r\n      var feature = context.first(data);\r\n      var ids = forms.getObjectIDS(tableCandidate);\r\n      var containers = ids.map(function (childId) {\r\n        return {\r\n          geometry: feature.geometry,\r\n          attributes: {\r\n            parentMRID: id,\r\n            parentClassName: \"Crew\",\r\n            chieldClassName: \"Route\",\r\n            chieldMRID: childId\r\n          }\r\n        }\r\n      });\r\n      var action = await (db.Location.addArray(containers));\r\n      if (action) {\r\n        data = await (db.Route.getByArray(ids));\r\n        features = context.all(data);\r\n        loadCrewRouteList(id);\r\n      }\r\n    });\r\n    bindClick(\"relinkCrewRoute\", async function () {\r\n      var ids = forms.getObjectIDS(table);\r\n      var chieldIds = \"chieldMRID=\" + ids.join(\" OR chieldMRID=\");\r\n      var where = \"parentMRID=\" + id + \" AND parentClassName='Crew' AND chieldClassName='Route' AND (\" + chieldIds + \")\";\r\n      var containers = await (db.Location.get({where: where}));\r\n      containers = context.all(containers);\r\n      ids = containers.map(function (item) {\r\n        return item.attributes.OBJECTID\r\n      });\r\n      await (db.Location.delByArray(ids));\r\n      forms.removeSelectedRows(table);\r\n    });\r\n    \r\n    bindClick(\"crewRouteRefresh\", async function () {\r\n      var editor = _getEditorLayer(\"Route\");\r\n      //noinspection JSUnresolvedFunction\r\n      var candidates = editor.getSelectedFeatures();\r\n      forms.createTable(tableCandidate, candidates, \"Route\");\r\n    });\r\n    \r\n    var features = await (getChields(id, \"Crew\", \"Route\", \"Location\"));\r\n    forms.createTable(table, features, \"Route\");\r\n    \r\n    var editor = _getEditorLayer(\"Route\");\r\n    //noinspection JSUnresolvedFunction\r\n    var candidates = editor.getSelectedFeatures();\r\n    forms.createTable(tableCandidate, candidates, \"Route\");\r\n  }\r\n  \r\n  async function loadCrewErpPersonList(id) {\r\n    var table = \"Crew-ErpPerson-List\";\r\n    var tableCandidate = \"Crew-ErpPerson-Candidate-List\";\r\n    \r\n    bindClick(\"linkCrewErpPerson\", async function () {\r\n      var data = await (db.Crew.getById(id));\r\n      var feature = context.first(data);\r\n      var ids = forms.getObjectIDS(tableCandidate);\r\n      var containers = ids.map(function (childId) {\r\n        return {\r\n          geometry: feature.geometry,\r\n          attributes: {\r\n            parentMRID: id,\r\n            parentClassName: \"Crew\",\r\n            chieldClassName: \"ErpPerson\",\r\n            chieldMRID: childId\r\n          }\r\n        }\r\n      });\r\n      var action = await (db.ErpPersonIdentificationObjectRole.addArray(containers));\r\n      if (action) {\r\n        data = await (db.ErpPerson.getByArray(ids));\r\n        features = context.all(data);\r\n        loadCrewErpPersonList(id);\r\n      }\r\n    });\r\n    bindClick(\"relinkCrewErpPerson\", async function () {\r\n      var ids = forms.getObjectIDS(table);\r\n      var chieldIds = \"chieldMRID=\" + ids.join(\" OR chieldMRID=\");\r\n      var where = \"parentMRID=\" + id + \" AND parentClassName='Crew' AND chieldClassName='ErpPerson' AND (\" + chieldIds + \")\";\r\n      var containers = await (db.ErpPersonIdentificationObjectRole.get({where: where}));\r\n      containers = context.all(containers);\r\n      ids = containers.map(function (item) {\r\n        return item.attributes.OBJECTID\r\n      });\r\n      await (db.ErpPersonIdentificationObjectRole.delByArray(ids));\r\n      forms.removeSelectedRows(table);\r\n    });\r\n    \r\n    var features = await (getChields(id, \"Crew\", \"ErpPerson\", \"ErpPersonIdentificationObjectRole\"));\r\n    forms.createTable(table, features, \"ErpPerson\");\r\n    \r\n    var candidates = await (db.ErpPerson.get({where: \"1=1\"}));\r\n    candidates = context.all(candidates);\r\n    forms.createTable(tableCandidate, candidates, \"ErpPerson\");\r\n  }\r\n  \r\n  function initGuardCrewTabs(data) {\r\n    var id = context.key(data);\r\n    loadGuardCrewErpPersonList(id);\r\n    loadGuardCrewRouteList(id);\r\n  }\r\n  \r\n  async function loadGuardCrewRouteList(id) {\r\n    var table = \"GuardCrew-Route-List\";\r\n    var tableCandidate = \"GuardCrew-Route-Candidate-List\";\r\n    \r\n    bindClick(\"linkGuardCrewRoute\", async function () {\r\n      var data = await (db.GuardCrew.getById(id));\r\n      var feature = context.first(data);\r\n      var ids = forms.getObjectIDS(tableCandidate);\r\n      var containers = ids.map(function (childId) {\r\n        return {\r\n          geometry: feature.geometry,\r\n          attributes: {\r\n            parentMRID: id,\r\n            parentClassName: \"GuardCrew\",\r\n            chieldClassName: \"Route\",\r\n            chieldMRID: childId\r\n          }\r\n        }\r\n      });\r\n      var action = await (db.Location.addArray(containers));\r\n      if (action) {\r\n        data = await (db.Route.getByArray(ids));\r\n        features = context.all(data);\r\n        loadGuardCrewRouteList(id);\r\n      }\r\n    });\r\n    bindClick(\"relinkGuardCrewRoute\", async function () {\r\n      var ids = forms.getObjectIDS(table);\r\n      var chieldIds = \"chieldMRID=\" + ids.join(\" OR chieldMRID=\");\r\n      var where = \"parentMRID=\" + id + \" AND parentClassName='GuardCrew' AND chieldClassName='Route' AND (\" + chieldIds + \")\";\r\n      var containers = await (db.Location.get({where: where}));\r\n      containers = context.all(containers);\r\n      ids = containers.map(function (item) {\r\n        return item.attributes.OBJECTID\r\n      });\r\n      await (db.Location.delByArray(ids));\r\n      forms.removeSelectedRows(table);\r\n    });\r\n    \r\n    bindClick(\"GuardCrewRouteRefresh\", async function () {\r\n      var editor = _getEditorLayer(\"Route\");\r\n      //noinspection JSUnresolvedFunction\r\n      var candidates = editor.getSelectedFeatures();\r\n      forms.createTable(tableCandidate, candidates, \"Route\");\r\n    });\r\n    \r\n    var features = await (getChields(id, \"GuardCrew\", \"Route\", \"Location\"));\r\n    forms.createTable(table, features, \"Route\");\r\n    \r\n    var editor = _getEditorLayer(\"Route\");\r\n    //noinspection JSUnresolvedFunction\r\n    var candidates = editor.getSelectedFeatures();\r\n    forms.createTable(tableCandidate, candidates, \"Route\");\r\n  }\r\n  \r\n  async function getChields(parentMRID, parentClassName, chieldClassName, proxyClassName) {\r\n    var where = \"parentClassName = '\" + parentClassName + \"' AND chieldClassName='\" + chieldClassName + \"' AND parentMRID=\" + parentMRID;\r\n    var data = await db[proxyClassName].get({where: where});\r\n    var features = context.all(data);\r\n    var ids = features.map(function (item) {\r\n      return item.attributes.chieldMRID\r\n    });\r\n    data = await (db[chieldClassName].getByArray(ids));\r\n    features = context.all(data);\r\n    return features;\r\n  }\r\n  \r\n  return {\r\n    initCrewTabs: initCrewTabs,\r\n    initGuardCrewTabs: initGuardCrewTabs\r\n  }\r\n});"]}