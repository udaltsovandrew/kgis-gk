{"version":3,"sources":["acLineSegment.js"],"names":[],"mappings":"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","file":"acLineSegment-compiled.js","sourcesContent":["/**\r\n * Created by udaltsov on 30.10.15.\r\n */\r\n\"use strict\";\r\n\r\ndefine([\r\n    \"./js/app/dataAccess/model-compiled.js\",\r\n    \"./js/app/domain/carto-compiled.js\",\r\n    \"./js/app/domain/generators-compiled.js\"\r\n  ],\r\n  function (model,\r\n            carto,\r\n            generators) {\r\n\r\n    var context = new model({url: \"\", className: \"\", map: map});\r\n\r\n    var proto = {\r\n      base:    {\r\n        className: \"ACLineSegment\"\r\n      },\r\n      chields: []\r\n    };\r\n\r\n    function create(line) {\r\n      var feature = generators.ACLineSegment.default;\r\n      feature.geometry = line;\r\n      return db.ACLineSegment.add(feature);\r\n    }\r\n\r\n    function createDefault(line) {\r\n      var feature = generators.ACLineSegment.default;\r\n      feature.geometry = line;\r\n      return db.ACLineSegment.add(feature);\r\n    }\r\n\r\n    function read(id) {\r\n      return db.ACLineSegment.getById(id);\r\n    }\r\n\r\n    function allByParent(id) {\r\n      return db.EquipmentContainer\r\n        .get({where: context.containerWhere(\"PowerLine\", \"ACLineSegment\", id, null)})\r\n        .then(function (data) {\r\n          var features = context.all(data);\r\n          var ids = featuresPropertyToArray(features, \"chieldMRID\");\r\n          return db.ACLineSegment.getByArray(ids)\r\n        });\r\n    }\r\n\r\n    function linkToVoltageLevel(parentId, candidateId, terminalNumber) {\r\n      var _feature = null;\r\n      var _connectionNodes = [];\r\n      var _voltageLevel = null;\r\n      var _acLineSegment = null;\r\n      var _container = null;\r\n      var _powerLine = null;\r\n      var _node = null;\r\n\r\n      return db.ACLineSegment.getById(parentId)\r\n        .then(function (data) {\r\n          //получаем сегмент\r\n          _feature = context.first(data);\r\n          //получаем коллекцию соединительных узлов\r\n          return db.AssetContainer.get({where: context.containerWhere('ACLineSegment', 'VoltageLevel', parentId, candidateId) + \" AND localName='terminal\" + terminalNumber + \"'\"})\r\n        })\r\n        .then(function (data) {\r\n\r\n          _connectionNodes = context.all(data);\r\n          //if (_connectionNodes.length != 0) return;\r\n          var geometry = null;\r\n          //получаем точку линии в зависимости от терминала\r\n          if (terminalNumber == 1) {\r\n            geometry = carto.getFirstPointInLine(_feature.geometry)\r\n          }\r\n          if (terminalNumber == 2) {\r\n            geometry = carto.getLastPointInLine(_feature.geometry)\r\n          }\r\n          //формируем шаблон соединения\r\n          _node = context.containerTemplate(parentId, candidateId, \"ACLineSegment\", \"VoltageLevel\", geometry);\r\n          _node.attributes.localName = 'terminal' + terminalNumber;\r\n          return db.AssetContainer.add(_node);\r\n        })\r\n        .then(function () {\r\n          //получаем РУ\r\n          return db.VoltageLevel.getById(candidateId);\r\n        })\r\n        .then(function (data) {\r\n          _voltageLevel = context.first(data);\r\n          //получаем сегмент\r\n          return db.ACLineSegment.getById(parentId);\r\n        })\r\n        .then(function (data) {\r\n          _acLineSegment = context.first(data);\r\n          //получаем контейнер оборудования ЛИНИЯ - СЕГМЕНТ\r\n          return db.EquipmentContainer.get({where: context.containerWhere('PowerLine', 'ACLineSegment', null, parentId)});\r\n        })\r\n        .then(function (data) {\r\n          _container = context.first(data);\r\n          //получаем ЛИНИЮ\r\n          return db.PowerLine.getById(_container.attributes[\"parentMRID\"]);\r\n        })\r\n        .then(function (data) {\r\n          _powerLine = context.first(data);\r\n          //присваиваем напряжение\r\n          _acLineSegment.attributes[\"nominalVoltage\"] = _voltageLevel.attributes[\"nominalVoltage\"];\r\n          _powerLine.attributes[\"nominalVoltage\"] = _voltageLevel.attributes[\"nominalVoltage\"];\r\n          db.ACLineSegment.set(_acLineSegment);\r\n          db.PowerLine.set(_powerLine);\r\n          //зачем-то возвращаем РУ\r\n          return db.VoltageLevel.getById(candidateId);\r\n        });\r\n    }\r\n\r\n    async function connectToCandidate(parentId, terminalNumber, candidateId, candidateClassName, isGetNominalVoltage) {\r\n      var data = await db.ACLineSegment.getById(parentId);\r\n      //получаем сегмент\r\n      var acLineSegment = context.first(data);\r\n      //получаем коллекцию соединительных узлов\r\n      var where = \"parentClassName='ACLineSegment' AND localName='terminal\" + terminalNumber + \"' AND parentMRID=\" + parentId;\r\n      data = await db.AssetContainer.get({where: where});\r\n      var containers = data.features;\r\n      //удаляем существующие соединения с объектами\r\n      if (containers) containers.forEach(function (item) { db.AssetContainer.delById(item.attributes.OBJECTID); });\r\n      //получаем точку связи из сегмента в зависимости от терминала\r\n      var point = terminalNumber === 1 ? carto.getFirstPointInLine(acLineSegment.geometry) : carto.getLastPointInLine(acLineSegment.geometry);\r\n      //формируем (записываем) шаблон соединения\r\n      var connectivityNode = context.containerTemplate(parentId, candidateId, \"ACLineSegment\", candidateClassName, point);\r\n      connectivityNode.attributes.localName = 'terminal' + terminalNumber;\r\n      var action = await db.AssetContainer.add(connectivityNode);\r\n      var connectivityNodeId = action[0][0].objectId;\r\n      //получаем объект дочернего класса\r\n      data = await db[candidateClassName].getById(candidateId);\r\n      var candidate = context.first(data);\r\n      //получаем сегмент\r\n      //получаем контейнер оборудования ЛИНИЯ - СЕГМЕНТ\r\n      data = await db.EquipmentContainer.get({where: context.containerWhere('PowerLine', 'ACLineSegment', null, parentId)});\r\n      var equipmentContainer = context.first(data);\r\n      //получаем ЛИНИЮ\r\n      data = await db.PowerLine.getById(equipmentContainer.attributes.parentMRID);\r\n      var powerLine = context.first(data);\r\n      //присваиваем напряжение\r\n      var nominalVoltage = candidate.attributes.nominalVoltage;\r\n      if ((nominalVoltage) && (isGetNominalVoltage)) {\r\n        acLineSegment.attributes[\"nominalVoltage\"] = nominalVoltage;\r\n        powerLine.attributes[\"nominalVoltage\"] = nominalVoltage;\r\n        db.PowerLine.set(powerLine);\r\n        db.ACLineSegment.set(acLineSegment);\r\n      }\r\n      return candidate;\r\n    }\r\n\r\n    async function disconnectFromCandidate(parentId, terminalNumber, candidateId) {\r\n      var where = \"parentClassName='ACLineSegment' AND localName='terminal\" + terminalNumber + \"'\" +\r\n        \" AND parentMRID=\" + parentId + \" AND chieldMRID=\" + candidateId;\r\n      var data = await db.AssetContainer.get({where: where});\r\n      var feature = context.first(data);\r\n      var action = db.AssetContainer.delById(feature.attributes.OBJECTID);\r\n      return action !== undefined;\r\n    }\r\n\r\n    function update(data) {\r\n    }\r\n\r\n    function updateParent(feature) {\r\n      var id = context.key(feature);\r\n      var parentId = null;\r\n      var _powerLine = null;\r\n      var acLineSegments = [];\r\n      _updateLayerByFeature(\"ACLineSegment\", feature, \"OBJECTID\");\r\n      return db.EquipmentContainer.get({where: context.containerWhere(\"PowerLine\", \"ACLineSegment\", null, id)})\r\n        .then(function (data) {\r\n          _powerLine = context.first(data);\r\n          parentId = context.keyByField(_powerLine, \"parentMRID\");\r\n          return db.EquipmentContainer.get({where: context.containerWhere(\"PowerLine\", \"ACLineSegment\", parentId, null)})\r\n        })\r\n        .then(function (data) {\r\n          return db.ACLineSegment.getByArray(featuresToArray(data, \"chieldMRID\"))\r\n        })\r\n        .then(function (data) {\r\n          acLineSegments = context.all(data);\r\n          return db.PowerLine.getById(parentId);\r\n        })\r\n        .then(function (data) {\r\n          _powerLine = context.first(data);\r\n          _powerLine.geometry = carto.sumLineGeometry(acLineSegments);\r\n          _updateLayerByFeature(\"PowerLine\", _powerLine, \"OBJECTID\");\r\n          return db.PowerLine.set(_powerLine);\r\n        })\r\n    }\r\n\r\n    function updateByVoltageLevel(feature) {\r\n      var voltageLevelId = context.key(feature);\r\n      var acLineSegments = null;\r\n      var assetContainers = null;\r\n      return db.AssetContainer\r\n        .get({where: context.containerWhere(\"ACLineSegment\", \"VoltageLevel\", null, voltageLevelId)})\r\n        .then(function (data) {\r\n          assetContainers = context.all(data);\r\n          return db.ACLineSegment.getByArray(featuresToArray(data, \"parentMRID\"));\r\n        })\r\n        .then(function (data) {\r\n          acLineSegments = context.all(data);\r\n          for (var i = 0; i < acLineSegments.length; i++) {\r\n            acLineSegments[i].geometry = carto.updateLineByPoint(acLineSegments[i].geometry, assetContainers[i].geometry, feature.geometry);\r\n          }\r\n          for (var i = 0; i < assetContainers.length; i++) {\r\n            assetContainers[i].geometry = feature.geometry;\r\n          }\r\n          return db.ACLineSegment.setArray(acLineSegments);\r\n        })\r\n        .then(function () {\r\n          return db.AssetContainer.setArray(assetContainers);\r\n        })\r\n        .then(function () {\r\n          for (var i = 0; i < acLineSegments.length; i++) {\r\n            updateParent(acLineSegments[i]);\r\n          }\r\n        })\r\n    }\r\n\r\n    function generateStructures(data, template) {\r\n      var points = [];\r\n      var structures = [];\r\n      var parentId = context.key(data);\r\n\r\n      var geometry = data.geometry.paths[0];\r\n      var generationTemplate = template;\r\n\r\n      for (var i = 0; i < geometry.length; i++) {\r\n        var attributes = {};\r\n        var structurePrototype = getStructureAssetType(generationTemplate, i);\r\n        attributes[\"localName\"] = (i + 1);\r\n        attributes[\"aliasName\"] = (i + 1);\r\n        attributes[\"assetType\"] = structurePrototype.assetType;\r\n        attributes[\"towerConstruction\"] = structurePrototype.towerConstruction;\r\n        attributes[\"material\"] = structurePrototype.material;\r\n        attributes[\"assetUsage\"] = structurePrototype.assetUsage;\r\n\r\n        var structureGeom = carto.getNPointInLine(data.geometry, i);\r\n        points.push({\r\n          geometry:   structureGeom,\r\n          attributes: attributes\r\n        });\r\n      }\r\n\r\n      if (generationTemplate.length == 1) {\r\n        for (var i = 1; i < geometry.length - 1; i++) {\r\n          points[i].attributes[\"localName\"] = i;\r\n          points[i].attributes[\"aliasName\"] = i;\r\n          structures.push(points[i]);\r\n        }\r\n      }\r\n      if (generationTemplate.length > 1) {\r\n        for (var i = 0; i < geometry.length; i++) {\r\n          points[i].attributes[\"localName\"] = i;\r\n          points[i].attributes[\"aliasName\"] = i;\r\n          structures.push(points[i]);\r\n        }\r\n      }\r\n\r\n      for (var i = 0; i < structures.length; i++) {\r\n        db.Structure\r\n          .add(structures[i])\r\n          .then(function (data) {\r\n            var id = data[0][0].objectId;\r\n            return addStructureLink(parentId, id);\r\n          })\r\n      }\r\n\r\n      function addStructureLink(parentMRID, chieldMRID) {\r\n        var feature = null;\r\n        return db.Structure\r\n          .getById(chieldMRID)\r\n          .then(function (data) {\r\n            feature = context.first(data);\r\n            var container = context.containerTemplate(parentMRID, chieldMRID, \"ACLineSegment\", \"Structure\", feature.geometry);\r\n            return db.EquipmentContainer.add(container);\r\n          })\r\n      }\r\n\r\n      function getStructureAssetType(data, n) {\r\n        var result = {};\r\n        result.assetType = \"промежуточная (П)\";\r\n        result.towerConstruction = \"Одностоечная\";\r\n        result.material = \"Железобетонная\";\r\n        result.assetUsage = \"на балансе\";\r\n        var template = data.split('-');\r\n        var index = n % template.length;\r\n        var item = \"(\" + template[index] + \")\";\r\n        for (var i = 0; i < config.classes.Structure.length; i++) {\r\n          var pattern = config.classes.Structure[i];\r\n          if (pattern.indexOf(item) > -1) {\r\n            result.assetType = pattern;\r\n            result.towerConstruction = generators.Structure[pattern].attributes[\"towerConstruction\"];\r\n            result.material = generators.Structure[pattern].attributes[\"material\"];\r\n            result.assetUsage = generators.Structure[pattern].attributes[\"assetUsage\"];\r\n            return result;\r\n          }\r\n        }\r\n        return result;\r\n      }\r\n    }\r\n\r\n    function del(id) {\r\n      return db.ACLineSegment.delById(id);\r\n    }\r\n\r\n    function deleteChields(id) {\r\n    }\r\n\r\n    return {\r\n      proto:                   proto,\r\n      create:                  create,\r\n      read:                    read,\r\n      allByParent:             allByParent,\r\n      update:                  update,\r\n      updateParent:            updateParent,\r\n      updateByVoltageLevel:    updateByVoltageLevel,\r\n      generateStructures:      generateStructures,\r\n      del:                     del,\r\n      linkToVoltageLevel:      linkToVoltageLevel,\r\n      deleteChields:           deleteChields,\r\n      createDefault:           createDefault,\r\n      connectToCandidate:      connectToCandidate,\r\n      disconnectFromCandidate: disconnectFromCandidate\r\n    }\r\n  });\r\n"]}