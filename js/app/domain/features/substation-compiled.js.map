{"version":3,"sources":["substation.js"],"names":[],"mappings":"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","file":"substation-compiled.js","sourcesContent":["/**\r\n * Created by udaltsov on 30.10.15.\r\n */\r\n\"use strict\";\r\n\r\ndefine([\r\n    \"./js/app/dataAccess/model-compiled.js\",\r\n    \"./js/app/domain/generators-compiled.js\"\r\n  ],\r\n  function (model,\r\n            generators) {\r\n\r\n    var context = new model({url: \"\", className: \"\", map: map});\r\n\r\n    var proto = {\r\n      base: {\r\n        className: \"Substation\"\r\n      },\r\n      chields: [\r\n        {\r\n          className: \"VoltageLevel\"\r\n        },\r\n        {\r\n          className: \"PowerTransformer\"\r\n        },\r\n        {\r\n          className: \"ErpAddress\"\r\n        }\r\n      ]\r\n    };\r\n\r\n    function create(point) {\r\n      var feature = generators.Substation.default;\r\n      feature.geometry = point;\r\n      return db.Substation\r\n        .add(feature)\r\n        .then(function (data) {\r\n          var id = data[0][0].objectId;\r\n          return db.Substation.getById(id);\r\n        })\r\n    }\r\n\r\n    function createDefaultEquipment(id){\r\n      var feature = null;\r\n      var parentId = id;\r\n      var voltageLevel10 = null;\r\n      var voltageLevel04 = null;\r\n      var container10 = null;\r\n      var container04 = null;\r\n      return read(id)\r\n        .then(function(data){\r\n           feature = context.first(data);\r\n           voltageLevel10 = generators.VoltageLevel.U10;\r\n           voltageLevel10.geometry = feature.geometry;\r\n          return db.VoltageLevel.add(voltageLevel10);\r\n        })\r\n        .then(function(data){\r\n          return db.VoltageLevel.getById(data[0][0].objectId);\r\n        })\r\n        .then(function(data){\r\n          voltageLevel10 = context.first(data);\r\n          voltageLevel04 = generators.VoltageLevel.U04;\r\n          voltageLevel04.geometry = feature.geometry;\r\n          return db.VoltageLevel.add(voltageLevel04);\r\n        })\r\n        .then(function(data){\r\n          return db.VoltageLevel.getById(data[0][0].objectId);\r\n        })\r\n        .then(function(data){\r\n          voltageLevel04 = context.first(data);\r\n          container10 = context.containerTemplate(parentId, voltageLevel10.attributes[\"OBJECTID\"],\"Substation\", \"VoltageLevel\", feature.geometry);\r\n          return db.EquipmentContainer.add(container10);\r\n        })\r\n        .then(function(){\r\n          container04 = context.containerTemplate(parentId, voltageLevel04.attributes[\"OBJECTID\"],\"Substation\", \"VoltageLevel\", feature.geometry);\r\n          return db.EquipmentContainer.add(container04);\r\n        })\r\n        .then(function(){\r\n          return db.Substation.getById(parentId);\r\n        })\r\n    }\r\n\r\n    function read(id) {\r\n      return db.Substation.getById(id);\r\n    }\r\n\r\n    function update(data) {\r\n    }\r\n\r\n    function del(id) {\r\n      return db.Substation.delById(id);\r\n    }\r\n\r\n    function deleteChields(id) {\r\n      var parentMRID = id;\r\n      var voltageLevelIds = [];\r\n      var powerTransformerIds = [];\r\n      var equipmentContainerIds = [];\r\n      db.EquipmentContainer\r\n        .get({where: \"parentClassName='Substation' AND parentMRID = \" + parentMRID})\r\n        .then(function (data) {\r\n          equipmentContainerIds = featuresPropertyToArray(context.all(data), \"OBJECTID\");\r\n          voltageLevelIds = context.allByFilter(data, \"chieldClassName\", \"VoltageLevel\");\r\n          powerTransformerIds = context.allByFilter(data, \"chieldClassName\", \"PowerTransformer\");\r\n          voltageLevelIds = featuresPropertyToArray(voltageLevelIds, \"chieldMRID\");\r\n          powerTransformerIds = featuresPropertyToArray(powerTransformerIds, \"chieldMRID\");\r\n          return db.VoltageLevel.delByArray(voltageLevelIds);\r\n        })\r\n        .then(function () {\r\n          return db.PowerTransformer.delByArray(powerTransformerIds);\r\n        })\r\n        .then(function () {\r\n          return db.EquipmentContainer.delByArray(equipmentContainerIds);\r\n        })\r\n    }\r\n\r\n    return {\r\n      proto: proto,\r\n      create: create,\r\n      createDefaultEquipment: createDefaultEquipment,\r\n      read: read,\r\n      update: update,\r\n      del: del,\r\n      deleteChields: deleteChields\r\n    }\r\n  });\r\n"]}