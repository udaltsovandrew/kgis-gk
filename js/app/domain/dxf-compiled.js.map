{"version":3,"sources":["dxf.js"],"names":[],"mappings":"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","file":"dxf-compiled.js","sourcesContent":["/**\n * Created by udaltsov on 30.06.16.\n */\ndefine([\n    \"./js/app/forms/forms-compiled.js\",\n    \"./js/app/dataAccess/model-compiled.js\",\n    \"./js/app/domain/http-compiled.js\",\n  ],\n  function (forms,\n            model,\n            httpUtils) {\n\n    function filterData(features, property, value) {\n      var result = [];\n      for (var i = 0; i < features.length; i++) {\n        if (features[i].attributes[property] === value) {\n          var feature = {\n            geometry:   features[i].geometry,\n            attributes: features[i].attributes\n          };\n          feature.attributes.statusRemarks = value;\n          delete feature.attributes.layer;\n          result.push(feature);\n        }\n      }\n      return result;\n    }\n\n    function loadNetworkProject() {\n      \"use strict\";\n      const windowName = \"networkProject-container\";\n      forms.toWindow(windowName, \"Импорт проекта присоединения\");\n      forms.showWindow(windowName);\n\n      var statusRemarks;\n      var _features;\n      var _powerLines;\n      var _substations;\n      var _structures;\n      var _data;\n      var element = $(\"#networkProject-result\");\n\n      forms\n        .getUpload(\"importProjectDocument\", config.documents.saveUrl + \"?className=Project\" + \"&id=\" + 0)\n        .then(function (data) {\n          var filesData = data;\n          var fileName = filesData[0].name;\n          return new Promise(function (resolve, reject) {\n            setTimeout(function () {\n              resolve(fileName);\n            }, 1000);\n          });\n        })\n        .then(function (data) {\n          return httpUtils.GET(\"http://localhost:3000/importDxf/\" + data);\n        })\n        .then(function (data) {\n          console.log(data);\n          _data = JSON.parse(data);\n          _features = _data.features;\n          _powerLines = filterData(_features, \"layer\", \"PowerLine\");\n          _substations = filterData(_features, \"layer\", \"Substation\");\n          _structures = filterData(_features, \"layer\", \"Structure\");\n\n          statusRemarks = data.statusRemarks;\n          return db.PowerLine.del({where: \"statusRemarks='\" + statusRemarks + \"'\"});\n        })\n        .then(function () {\n          return db.PowerLine.del({where: \"statusRemarks='\" + statusRemarks + \"'\"});\n        })\n        .then(function () {\n          return db.Structure.del({where: \"statusRemarks='\" + statusRemarks + \"'\"});\n        })\n        .then(function () {\n          for (let i = 0; i < _substations.length; i++) {\n            db.Substation.add(_substations[i]);\n          }\n          for (let i = 0; i < _structures.length; i++) {\n            db.Structure.add(_structures[i]);\n          }\n          for (let i = 0; i < _powerLines.length; i++) {\n            db.PowerLine.add(_powerLines[i]);\n          }\n        });\n    }\n\n    return {\n      loadNetworkProject: loadNetworkProject\n    };\n  });"]}